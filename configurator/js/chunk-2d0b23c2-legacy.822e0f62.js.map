{"version":3,"sources":["webpack:///./node_modules/@roomle/web-sdk/lib/glb-viewer-7900c0c4.js"],"names":["INJECTABLES","AdjustableCameraControl3D","super","arguments","this","shouldIgnoreStandardBehavior","e","t","n","i","r","s","THREE","Vector3","x","z","a","y","_boundingBox","Box3","o","Euler","Math","PI","c","Quaternion","setFromEuler","_camera","updateProjectionMatrix","quaternion","copy","position","_saveYawAndPitch","_update","animateCamera","GLBViewerLightSetting","_params","ambientLight","color","_ambientLight","AmbientLight","Color","addToScene","_scene","add","remove","removeFromScene","addFolder","min","max","step","addColor","onChange","GLBViewerSceneManager","GLB","_itemsCount","_standardSceneBackgroundColor","background","_renderer","capabilities","maxTextures","loadDynamicLightSetting","createDynamicLightSettingSource","CAMERA","console","warn","_lightSetting","_setEnvironment","_environment","_cameraControl","_creator_","_getInputManager","_glbInputManager","_rapiAccess","getItem","configuration","Promise","reject","loadGLB","clearScene","_loadGLB","then","_currentGLB","_domHelper","getClientDimensions","setFromObject","getSize","getCenter","updateToBounds","reset","_updateBounds","WebGLRenderer","antialias","setSize","outputEncoding","sRGBEncoding","autoClear","shadowMap","enabled","type","BasicShadowMap","getCamera","clone","PerspectiveCamera","aspect","render","domElement","toDataURL","toBlob","image","width","height","blob","adjust","_requestRender","round","enableHD","_pixotron","enableAA","getSAOPass","saoparams","intensity","occlusionWorldRadius","smoothTransition","samplesPerFrame","bias","numSamples","accumulative","falloff","shadowparams","shadowMapResolution","shadowRadius","shadowQuality","enableAccumulation","shadowBiasMultiplier","nearPlane","farPlane","fov","side","FrontSide","enable","numSamplesPerFrame","bShadowMaterial","darkness","size","lightDirection","lightSolidAngle","prototype","GLBRenderWorker","_prefix","_listeners","Set","_finishedItems","_sceneManager","alpha","_width","_height","setClearColor","delete","_entries","forEach","push","_transform","onStart","length","_zip","window","JSZip","_doNextEntry","_resolve","name","path","replace","url","camera","fieldOfView","yaw","rotation","pitch","onFinished","_processEntry","adjustCamera","preparePerspectiveImage","_entryFinished","indexOf","splice","onElementFinished","file","RoomleGLBViewer","_currentIdOrUrl","setCameraOffset","getCameraOffset","setOverrides","setDomElement","_lifeCycleManager","resume","resolve","_initPromiseCallback","bind","_threeLoader","fetch","_scriptLoader","id","all","left","top","right","bottom","map","trackView","loadStaticItem","loadSceneSettings","loadQualitySetting","JSON","parse","addListener","start","items","generateAsync","document","createElement","href","URL","createObjectURL","download","style","display","body","appendChild","click","removeChild","removeListener","_initData","_globalInitData","updateCamera","pause","showGUI","getScene","updateScene","GlbViewer","setup","lookup","_context","Error","_viewer"],"mappings":"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","file":"js/chunk-2d0b23c2-legacy.822e0f62.js","sourcesContent":["import\"./query-params-helper-a271f9dc.js\";import{l as DependencyInjectionAssignment,L as Logger,m as RapiAccess,f as getGUI,_ as __decorate,i as inject,e as DynamicLightSettingLoader,P as PREDEFINED_LIGHTSETTING,d as dispose,G as GLTF_LOADER_FILE_NAME,a3 as DRACO_LOADER_FILE_NAME,q as RoomleDependencyInjection}from\"./rapi-access-413632b4.js\";import{j as getGlbUrl}from\"./main-thread-to-worker-8efc9a92.js\";import{I as InputManager,S as ScriptLoader,f as DomHelper,C as CameraControl3D,L as LightSetting,a as CANVAS_ID,B as BakedShadowEnvironment,T as TWEEN_FILE_NAME,g as PIXOTRON_EFFETCS,i as PIXOTRON_FILE_NAME,M as Main}from\"./pixotron-2f79bd46.js\";import{D as DefaultLightSetting}from\"./default-light-setting-3329a5c3.js\";import{S as SceneManager}from\"./scene-manager-87a03313.js\";const INJECTABLES=[new DependencyInjectionAssignment(\"script-loader\",ScriptLoader),new DependencyInjectionAssignment(\"dom-helper\",DomHelper,1),new DependencyInjectionAssignment(\"glb-input-manager\",class extends InputManager{},1),new DependencyInjectionAssignment(\"logger\",Logger),new DependencyInjectionAssignment(\"rapi-access\",RapiAccess)];class AdjustableCameraControl3D extends CameraControl3D{constructor(){super(...arguments),this.shouldIgnoreStandardBehavior=!1}adjust(e,t,n,i,r){let s=new THREE.Vector3(-e.x/2,0,-e.z/2),a=new THREE.Vector3(e.x/2,e.y,e.z/2);this._boundingBox=new THREE.Box3(s,a);let o=new THREE.Euler(-Math.PI/2+i,n,0,\"ZYX\"),c=(new THREE.Quaternion).setFromEuler(o);this._camera.updateProjectionMatrix(),this._camera.quaternion.copy(c),this._camera.position.copy(t)}_update(e){this.shouldIgnoreStandardBehavior?this._saveYawAndPitch():super._update(e)}animateCamera(e){return!!this.shouldIgnoreStandardBehavior||super.animateCamera(e)}}class GLBViewerLightSetting extends LightSetting{constructor(e,t){super(e,t),this._params={ambientLight:{color:\"#ffffff\"}},this._ambientLight=new THREE.AmbientLight(new THREE.Color(this._params.ambientLight.color),.5),this.addToScene()}addToScene(){this._scene.add(this._ambientLight)}removeFromScene(){this._scene.remove(this._ambientLight)}reload(){this.removeFromScene(),this.addToScene()}showGUI(){let e=getGUI();if(e&&this._ambientLight){let t=e.addFolder(\"Ambient Light\");t.add(this._ambientLight,\"visible\"),t.add(this._ambientLight,\"intensity\").min(0).max(5).step(.1),t.addColor(this._params.ambientLight,\"color\").onChange(e=>{this._ambientLight.color=new THREE.Color(e)})}}}let GLBViewerSceneManager=(()=>{class e extends SceneManager{constructor(e,t){super(e,t,CANVAS_ID.GLB,\"3D\"),this._itemsCount=0,this._standardSceneBackgroundColor=this._scene.background,this._renderer.capabilities.maxTextures>8?this.loadDynamicLightSetting(DynamicLightSettingLoader.createDynamicLightSettingSource(null,PREDEFINED_LIGHTSETTING.CAMERA)):(console.warn(\"this device has a maximum of 8 texture units thus we are using a simpler light setting\"),this._lightSetting=new GLBViewerLightSetting(this._scene)),this._setEnvironment(new BakedShadowEnvironment(this._scene,this._environment))}createCameraControl(e){this._cameraControl=new AdjustableCameraControl3D(this._creator_,this._getInputManager(),new THREE.Vector3(-1,1,1))}_getInputManager(){return this._glbInputManager}async loadStaticItem(e,t){const n=await this._rapiAccess.getItem(e);return n.configuration?Promise.reject():this.loadGLB(getGlbUrl(n),!0,void 0,t)}loadGLB(e,t=!0,n=new THREE.Vector3(1,1,1),i){return this.clearScene(),new Promise((r,s)=>{this._loadGLB(e,new THREE.Vector3(0,0,0),0,void 0,n,void 0,void 0,i).then(e=>{this._currentGLB=e,this._scene.add(this._currentGLB);let{x:n,y:i}=this._domHelper.getClientDimensions(),s=(new THREE.Box3).setFromObject(this._currentGLB),a=s.getSize(new THREE.Vector3);if(t){let e=s.getCenter(new THREE.Vector3);this._cameraControl instanceof AdjustableCameraControl3D&&(this._cameraControl.updateToBounds(s,n,i,!1,!0,e),this._cameraControl.reset(a,n,i,e,-15,0))}this._updateBounds(s),r()},s)})}preparePerspectiveImage(e,t,n){return new Promise(i=>{t||(t=1e3),n||(n=1e3),e||((e=new THREE.WebGLRenderer({antialias:!0})).setSize(t,n),e.outputEncoding=THREE.sRGBEncoding,e.autoClear=!1,e.shadowMap.enabled=!0,e.shadowMap.type=THREE.BasicShadowMap);let r=this._cameraControl.getCamera().clone();r instanceof THREE.PerspectiveCamera&&(r.aspect=t/n,r.updateProjectionMatrix()),this._lightSetting.removeFromScene();let s=new DefaultLightSetting(this._scene);e.render(this._scene,r);let a=e.domElement.toDataURL();e.domElement.toBlob(e=>{i({image:a,width:t,height:n,blob:e})},\"image/png\"),s.removeFromScene(),this._lightSetting.addToScene()})}adjustCamera(e,t,n,i){if(this._cameraControl instanceof AdjustableCameraControl3D){let r=(new THREE.Box3).setFromObject(this._scene).getSize(new THREE.Vector3);this._cameraControl.adjust(r,e,t,n,i),this._requestRender()}}onStart(e){this._itemsCount=e,this._scene.background=null,this._cameraControl instanceof AdjustableCameraControl3D&&(this._cameraControl.shouldIgnoreStandardBehavior=!0)}onElementFinished(e){this._itemsCount,Math.round(100/this._itemsCount*e)}onFinished(e){this._scene.background=this._standardSceneBackgroundColor,this._cameraControl instanceof AdjustableCameraControl3D&&(this._cameraControl.shouldIgnoreStandardBehavior=!1)}clearScene(){this._currentGLB&&(this._scene.remove(this._currentGLB),dispose(this._currentGLB),this._currentGLB=null),super.clearScene()}enableHD(){super.enableHD(),this._pixotron.enableAA=!1,this._pixotron.getSAOPass().enabled=!0}sceneChanged(){}getPixotronParams(){return{saoparams:{intensity:.25,occlusionWorldRadius:.4,smoothTransition:!0,samplesPerFrame:4,bias:.016,numSamples:200,accumulative:!1,falloff:1.5},shadowparams:{shadowMapResolution:1024,shadowRadius:3,shadowQuality:1,smoothTransition:!0,enableAccumulation:!0,shadowBiasMultiplier:.6,nearPlane:.01,farPlane:50,fov:110,side:THREE.FrontSide,numSamples:100}}}getBakedShadowParams(){return{enable:!0,shadowMapResolution:512,smoothTransition:!0,numSamples:500,numSamplesPerFrame:4,bShadowMaterial:!0,falloff:1.5,darkness:.2,size:1.6,lightDirection:new THREE.Vector3(0,1,.5),lightSolidAngle:40}}getBounds(){return this._currentGLB?(new THREE.Box3).setFromObject(this._currentGLB):null}}return __decorate([inject],e.prototype,\"_glbInputManager\",void 0),__decorate([inject],e.prototype,\"_rapiAccess\",void 0),e})();class GLBRenderWorker{constructor(e,t,n){this._prefix=\"https://furniture.roomle.com/3d/glb/\",this._listeners=new Set,this._finishedItems=0,this._sceneManager=e,this._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this._width=t,this._height=n,this._renderer.setSize(t,n),this._renderer.setClearColor(16777215,0),this._renderer.outputEncoding=THREE.sRGBEncoding}addListener(e){this._listeners.add(e)}removeListener(e){this._listeners.delete(e)}start(e){return this._entries=[],e.forEach(e=>{this._entries.push(this._transform(e))}),this._finishedItems=0,this._listeners.forEach(e=>e.onStart(this._entries.length)),this._zip=new window.JSZip,this._doNextEntry(),new Promise(e=>{this._resolve=e})}_transform(e){return{name:e.path.replace(\".glb\",\".png\"),url:this._prefix+e.path,position:new THREE.Vector3(e.camera.position.x,e.camera.position.z,-e.camera.position.y),fov:2*e.camera.fieldOfView,yaw:e.camera.rotation.z,pitch:e.camera.rotation.x}}_doNextEntry(){0===this._entries.length?(this._listeners.forEach(e=>e.onFinished(this._zip)),this._resolve(this._zip)):this._processEntry(this._entries[0])}_processEntry(e){this._sceneManager.loadGLB(e.url,!1,void 0).then(()=>{this._sceneManager.adjustCamera(e.position,e.yaw,e.pitch,e.fov),this._sceneManager.preparePerspectiveImage(this._renderer,this._width,this._height).then(t=>{this._entryFinished(e,t)})})}_entryFinished(e,t){let n=this._entries.indexOf(e);n>-1&&this._entries.splice(n,1),this._finishedItems++,this._listeners.forEach(e=>e.onElementFinished(this._finishedItems)),this._zip.file(e.name,t.blob),this._doNextEntry()}}let RoomleGLBViewer=(()=>{class e{constructor(e){this._currentIdOrUrl=null,this._creator_=e}setCameraOffset(e){this._sceneManager.setCameraOffset(e)}getCameraOffset(){return this._sceneManager.getCameraOffset()}init(e,t){return this.setOverrides(t),this._domHelper.setDomElement(e),this._sceneManager?(this._lifeCycleManager.resume(),Promise.resolve()):new Promise(this._initPromiseCallback.bind(this))}_initPromiseCallback(e,t){this._threeLoader.fetch().then(()=>{let t=this._scriptLoader.fetch(GLTF_LOADER_FILE_NAME,{id:\"gltf-loader\"}),n=this._scriptLoader.fetch(DRACO_LOADER_FILE_NAME,{id:\"draco-loader\"}),i=this._scriptLoader.fetch(TWEEN_FILE_NAME,{id:\"tween-js\"});Promise.all([t,n,i]).then(()=>{this._sceneManager=new GLBViewerSceneManager(this._creator_,{left:0,top:1,right:1,bottom:0}),this.enableHD(),e()})})}enableHD(){return new Promise((e,t)=>{const n=()=>{this._sceneManager.enableHD(),e()};Promise.all(PIXOTRON_EFFETCS.map(e=>this._scriptLoader.fetch(e,{id:e}))).then(()=>{this._scriptLoader.fetch(PIXOTRON_FILE_NAME,{id:\"pi-js\"}).then(n,t)},t)})}clearScene(){this._sceneManager.clearScene()}loadGLB(e,t=1,n){return this._currentIdOrUrl=e,this._rapiAccess.trackView(e),this._sceneManager.loadGLB(e,!0,new THREE.Vector3(t,t,t),n)}loadStaticItem(e,t){return this._currentIdOrUrl=e,this._rapiAccess.trackView(e),this._sceneManager.loadStaticItem(e,t)}getCurrentId(){return this._currentIdOrUrl}loadSceneSetting(e){return this._sceneManager.loadSceneSettings(e)}loadQualitySetting(e){this._sceneManager.loadQualitySetting(e)}preparePerspectiveImage(){return this._sceneManager.preparePerspectiveImage()}processRenderList(e,t=320,n=320){let i=JSON.parse(e);this._scriptLoader.fetch(\"static/jszip.min-dd6c9829408677a1.js\",{id:\"jszip-js\"}).then(()=>{let e=new GLBRenderWorker(this._sceneManager,t,n);e.addListener(this._sceneManager),e.start(i.items).then(t=>{t.generateAsync({type:\"blob\"}).then(t=>{let n=document.createElement(\"a\");n.href=URL.createObjectURL(t),n.download=\"content.zip\",n.style.display=\"none\",document.body.appendChild(n),n.click(),document.body.removeChild(n),e.removeListener(this._sceneManager)})})})}setOverrides(e){e&&(this._initData.setOverrides(e),this._globalInitData.setOverrides(e))}updateSize(){this._sceneManager.updateCamera()}getMain(){}resumeTest(e){this._domHelper.setDomElement(e),this._lifeCycleManager.resume()}pauseTest(){this._lifeCycleManager.pause()}showGUI(){this._sceneManager.showGUI()}get callbacks(){return{}}getScene(){return this._sceneManager.getScene()}updateScene(){this._sceneManager.updateScene()}}return __decorate([inject],e.prototype,\"_rapiAccess\",void 0),__decorate([inject],e.prototype,\"_domHelper\",void 0),__decorate([inject],e.prototype,\"_scriptLoader\",void 0),__decorate([inject],e.prototype,\"_lifeCycleManager\",void 0),__decorate([inject],e.prototype,\"_threeLoader\",void 0),__decorate([inject],e.prototype,\"_initData\",void 0),__decorate([inject],e.prototype,\"_globalInitData\",void 0),e})();class GlbViewer extends Main{setupGlobals(){}setupDependencies(){RoomleDependencyInjection.setup(INJECTABLES),this.lookup(\"logger\",this._context)}cleanUpGlobals(){throw new Error(\"Method not implemented.\")}cleanUpDependencies(){throw new Error(\"Method not implemented.\")}bootFinished(){this._viewer=new RoomleGLBViewer(this._context),window.RoomleGLBViewer||(window.RoomleGLBViewer=this._viewer)}getApi(){return this._viewer}getContextName(){return\"glb-viewer\"}}export{GlbViewer};\n//# sourceMappingURL=glb-viewer-7900c0c4.js.map\n"],"sourceRoot":""}