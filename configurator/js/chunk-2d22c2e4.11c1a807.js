(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22c2e4"],{f1ad:function(e,s,r){"use strict";r.r(s),r.d(s,"MessageHandler",(function(){return t}));class t{constructor(e,s,r,t){this._outgoingMessageBus=null,this._execMessage=null,this._side=e,this._incomingMessageBus=s,this._outgoingMessageBus=r,this._execMessage=t,this._incomingMessageBus.addEventListener("message",this._handleMessage.bind(this))}setOutgoingMessageBus(e){this._outgoingMessageBus=e}setMessageExecution(e){this._execMessage=e}sendMessage(e,s=[]){return new Promise((r,t)=>{const o=new MessageChannel;o.port1.onmessage=e=>{if(!e||!e.data)return o.port1.close(),o.port2.close(),t(new Error(this._side+" received message but response can not be interpreted"));let s;try{s=JSON.parse(e.data)}catch(i){return o.port1.close(),o.port2.close(),this._prepareError(i),t(i)}s.error?t(s.error):void 0!==s.result?r(s.result):r(),o.port1.close(),o.port2.close()};let i="";try{i=JSON.stringify({message:e,args:s})}catch(n){return t(new Error(this._side+": can not create command because it is not JSON.stringify able"))}if(!this._outgoingMessageBus)return t(new Error(this._side+": outgoing bus not set yet"));this._outgoingMessageBus.postMessage(i,"*",[o.port2])})}_handleMessage(e){const s=e.ports&&Array.isArray(e.ports)&&e.ports.length>0?e.ports[0]:null;if(e.data&&s)try{const r=JSON.parse(e.data);if(!this._execMessage)return s.postMessage(JSON.stringify({error:this._side+" is not ready to handle messages"}));Array.isArray(r.args)||(r.args=[r.args]);const t=this._execMessage(r,e);if(void 0===t)return;t.then((e={})=>{let r=void 0,t=void 0;"object"===typeof e&&null!==e&&(r=e.error,t=e.result),r?s.postMessage(JSON.stringify({error:r})):void 0!==t?s.postMessage(JSON.stringify({result:t})):s.postMessage(JSON.stringify({result:e}))},e=>{s.postMessage(JSON.stringify({error:this._prepareError(e)}))})}catch(r){s.postMessage(JSON.stringify({error:this._prepareError(r)}))}}_prepareError(e){if("string"===typeof e){const s=this._side+": "+e;return console.error(s),s}return e.message=this._side+": "+e.message,console.error(e),e.message}}}}]);
//# sourceMappingURL=chunk-2d22c2e4.11c1a807.js.map