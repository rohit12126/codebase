(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3cdbd03f"],{"03dd":function(e,t,i){"use strict";i.r(t),i.d(t,"MaterialViewer",(function(){return c}));i("4719");var s=i("12df"),a=(i("4a09"),i("2354")),r=i("ea7d"),n=i("a942"),o=i("d1a4");let h=(()=>{class e extends o["b"]{constructor(e,t){super(e,t,a["m"].RMV,"3D",!1),this._sceneParams={type:"cube"},this._materialParams={color:"#ffffff",metallic:.5,alpha:0,alphaCutoff:0,doubleSided:!1},this._renderer.capabilities.maxTextures>8&&this.loadDynamicLightSetting(s["U"].createDynamicLightSettingSource(null,s["q"].CAMERA)),this._initScene()}_initScene(){const e=new THREE.BoxGeometry(1,1,1,100,100,100),t=new THREE.MeshPhysicalMaterial({color:this._initData.colors.PRIMARY});this._environmentLoader.setEnvMap(t),this._setMaterial(t),this._mesh=new THREE.Mesh(e,this._material),this._mesh.castShadow=!0,this._mesh.position.setY(.5),this._scene.add(this._mesh);const{initialFloorMaterial:i}=this._initData;if(i?this.changeFloorMaterialById(i):this._environment=new a["n"](this._scene,null,new THREE.Color(16777215)),this._cameraControl instanceof a["b"]){const e=new THREE.Box3;e.setFromObject(this._mesh);let{x:t,y:i}=this._domHelper.getClientDimensions();this._cameraControl.updateAndReset(e.getSize(new THREE.Vector3),t,i,e.getCenter(new THREE.Vector3))}this.showGUI()}loadMaterialId(e){return new Promise(t=>{this._configuratorMeshGenerator.loadMaterial(e,1e3,1e3).then(e=>{this._setMaterial(e),this._mesh.material=this._material,this._updateGUI(),this._requestRender(!0),t()})})}loadMaterial(e){return new Promise(t=>{e.__rapi_path__||(e.__rapi_path__="materials"),this._setMaterial(Object(s["i"])(e,this._environmentLoader)),this._mesh.material=this._material,this._configuratorMeshGenerator.loadTextures(e,this._material,100,100).then(()=>{this._updateGUI(),this._requestRender(!0)}),t()})}loadMaterialShading(e){return new Promise(t=>{let i={shading:e};this._setMaterial(Object(s["L"])(this._material,i,this._environmentLoader)),this._mesh.material=this._material,this._updateGUI(),this._requestRender(!0),t()})}_setMaterial(e){this._material=e,this._materialParams.alpha=e.opacity,this._materialParams.alphaCutoff=e.alphaTest,this._materialParams.color="#"+e.color.getHexString(),this._materialParams.doubleSided=e.side===THREE.DoubleSide,this._materialParams.metallic=1===e.metalness?1:e.reflectivity}getMaterialShading(){return Object(s["M"])(this._material)}createCameraControl(e){this._cameraControl=new a["b"](this._creator_,this._getInputManager(),new THREE.Vector3(-1,1,1))}_getInputManager(){return this._inputManager}sceneChanged(){}getPixotronParams(){return{saoparams:{intensity:.25,occlusionWorldRadius:.6,smoothTransition:!0,samplesPerFrame:4,bias:.02,numSamples:200,accumulative:!0},shadowparams:{shadowMapResolution:1024,shadowRadius:1,shadowQuality:1,smoothTransition:!0,enableAccumulation:!0,shadowBiasMultiplier:.05,nearPlane:.01,farPlane:50,fov:40,numSamples:50,side:THREE.FrontSide}}}getBakedShadowParams(){return{enable:!1,smoothTransition:!0,numSamples:500,numSamplesPerFrame:4}}getBounds(){return this._mesh?(new THREE.Box3).setFromObject(this._mesh):null}_guiLoaded(){this._updateGUI()}_updateGUI(){let e=Object(s["V"])();e&&(this._guiGeometryFolder||(this._guiGeometryFolder=e.addFolder("Geometry"),this._guiGeometryFolder.add(this._sceneParams,"type",{Cube:"cube",Sphere:"sphere",PlaneVertical:"plane_vertical",PlaneHorizontal:"plane_horizontal"}).onChange(e=>{this._setGeometry()})),this._material&&(this._guiMaterialFolder&&e.removeFolder(this._guiMaterialFolder),this._guiMaterialFolder=e.addFolder("Material"),this._guiMaterialFolder.addColor(this._materialParams,"color").onChange(e=>{this._material.color=new THREE.Color(e),this._shadingChanged()}),this._guiMaterialFolder.add(this._materialParams,"metallic").min(0).max(1).step(.01).onChange(e=>{this._material.metalness=1===e?1:.5,this._material.reflectivity=e||.5,this._shadingChanged()}),this._guiMaterialFolder.add(this._material,"roughness").min(0).max(1).step(.01).onChange(e=>{this._shadingChanged()}),this._guiMaterialFolder.add(this._material,"transmission").min(0).max(1).step(.01).onChange(e=>{this._material.transmission=e,e>0&&(this._material.opacity=1,this._material.alphaTest=.5,this._material.depthWrite=!1,this._material.transparent=!0,this._material.metalness=0),this._mesh.castShadow=!this._material.transparent,this._shadingChanged()}),this._guiMaterialFolder.add(this._materialParams,"alpha").min(0).max(1).step(.01).onChange(e=>{this._material.transparent=e<1,this._material.opacity=e,this._material.depthWrite=e>=1,this._mesh.castShadow=!this._material.transparent,this._shadingChanged()}),this._guiMaterialFolder.add(this._materialParams,"alphaCutoff").min(0).max(1).step(.01).onChange(e=>{this._material.alphaTest=e||0,this._shadingChanged()}),this._guiMaterialFolder.add(this._materialParams,"doubleSided").onChange(e=>{this._material.side=e?THREE.DoubleSide:THREE.FrontSide,this._shadingChanged()})),this._addGUIListener(e))}_shadingChanged(){this._roomleMaterialViewerUiCallback.onMaterialShadingChanged(Object(s["M"])(this._material))}setGeometry(e){this._sceneParams.type=e,this._setGeometry()}_setGeometry(){let e;"cube"===this._sceneParams.type&&(e=new THREE.BoxGeometry(1,1,1,100,100,100)),"sphere"===this._sceneParams.type&&(e=new THREE.SphereGeometry(.5,100,100)),"plane_horizontal"===this._sceneParams.type&&(e=new THREE.PlaneGeometry(1,1),e.rotateX(-Math.PI/2)),"plane_vertical"===this._sceneParams.type&&(e=new THREE.PlaneGeometry(1,1)),this._mesh.geometry=e,this._requestRender(!0)}async changeFloorMaterialById(e){const t=await this._rapiAccess.getMaterial(e);return this._environment&&this._environment instanceof a["e"]||(this._environment=new a["e"](this._scene,this._environment,!0)),this._pixotron&&this._environment.setPixotron(this._pixotron,this._renderer,this._cameraControl.getCamera()),new Promise((e,i)=>{this._environment.changeFloorMaterial(t,this._maxAnisotropy).then(()=>{this._requestRender(),e()},i)})}async addTexture(e,t){const i=100/(0===e.mmWidth?1:e.mmWidth),a=100/(0===e.mmHeight?1:e.mmHeight);if(t){const r=new Image;r.src=t;const n=new THREE.Texture;n.image=r,r.onload=function(){n.needsUpdate=!0},Object(s["N"])(n,e,this._material,this._maxAnisotropy,i,a,this._renderer.capabilities.maxTextures)}else await Object(s["k"])(e.image,e,this._material,this._maxAnisotropy,i,a,this._renderer.capabilities.maxTextures);this._requestRender()}removeTexture(e){"ORM"===e.mapping&&(this._material.aoMap=null,this._material.roughnessMap=null,this._material.metalnessMap=null),"RGB"!==e.mapping&&"RGBA"!==e.mapping||(this._material.map=null),"XYZ"===e.mapping&&(this._material.normalMap=null),this._material.needsUpdate=!0,this._requestRender()}clearCache(){this._configuratorMeshGenerator.clear()}}return Object(s["B"])([s["Y"]],e.prototype,"_inputManager",void 0),Object(s["B"])([s["Y"]],e.prototype,"_configuratorMeshGenerator",void 0),Object(s["B"])([s["Y"]],e.prototype,"_roomleMaterialViewerUiCallback",void 0),Object(s["B"])([s["Y"]],e.prototype,"_rapiAccess",void 0),e})(),_=(()=>{class e{constructor(e){this._creator_=e}setCameraOffset(e){this._sceneManager.setCameraOffset(e)}getCameraOffset(){return this._sceneManager.getCameraOffset()}init(e){return this._domHelper.setDomElement(e),this._sceneManager?(this._lifeCycleManager.resume(),Promise.resolve()):new Promise(this._initPromiseCallback.bind(this))}_initPromiseCallback(e,t){this._threeLoader.fetch().then(()=>{let t=this._scriptLoader.fetch(s["h"],{id:"gltf-loader"}),i=this._scriptLoader.fetch(a["l"],{id:"tween-js"});Promise.all([t,i]).then(()=>{this._sceneManager=new h(this._creator_,{left:0,top:1,right:1,bottom:0}),this.enableHD(),e()})})}enableHD(){return new Promise((e,t)=>{const i=()=>{this._sceneManager.enableHD(),e()};Promise.all(a["s"].map(e=>this._scriptLoader.fetch(e,{id:e}))).then(()=>{this._scriptLoader.fetch(a["u"],{id:"pi-js"}).then(i,t)},t)})}get callbacks(){return this._roomleMaterialViewerUiCallback}set callbacks(e){this._roomleMaterialViewerUiCallback=e}loadMaterialShading(e){return this._sceneManager.loadMaterialShading(e)}loadMaterial(e,t={}){return t.flushCache&&this._clearCaches(),this._sceneManager.loadMaterial(e)}loadMaterialId(e,t={}){return t.flushCache&&this._clearCaches(),this._sceneManager.loadMaterialId(e)}getMaterialShading(){return this._sceneManager.getMaterialShading()}loadSceneSetting(e){return this._sceneManager.loadSceneSettings(e)}loadQualitySetting(e){this._sceneManager.loadQualitySetting(e)}setOverrides(e){e&&this._initData.setOverrides(e)}updateSize(){this._sceneManager.updateCamera()}getMain(){}resumeTest(e){this._domHelper.setDomElement(e),this._lifeCycleManager.resume()}pauseTest(){this._lifeCycleManager.pause()}showGUI(){this._sceneManager.showGUI()}async changeFloorMaterialById(e){return this._sceneManager.changeFloorMaterialById(e)}setGeometry(e){this._sceneManager.setGeometry(e)}async addTexture(e,t){return this._sceneManager.addTexture(e,t)}removeTexture(e){return this._sceneManager.removeTexture(e)}_clearCaches(){this._rapiAccess.cleanUp(),this._sceneManager.clearCache()}getScene(){return this._sceneManager.getScene()}updateScene(){this._sceneManager.updateScene()}}return Object(s["B"])([s["Y"]],e.prototype,"_domHelper",void 0),Object(s["B"])([s["Y"]],e.prototype,"_scriptLoader",void 0),Object(s["B"])([s["Y"]],e.prototype,"_lifeCycleManager",void 0),Object(s["B"])([s["Y"]],e.prototype,"_threeLoader",void 0),Object(s["B"])([s["Y"]],e.prototype,"_roomleMaterialViewerUiCallback",void 0),Object(s["B"])([s["Y"]],e.prototype,"_initData",void 0),Object(s["B"])([s["Y"]],e.prototype,"_rapiAccess",void 0),e})();const l=[new s["bb"]("script-loader",a["k"]),new s["bb"]("dom-helper",a["r"],1),new s["bb"]("logger",s["m"]),new s["bb"]("input-manager",a["g"],1),new s["bb"]("environment-loader",s["O"]),new s["bb"]("configurator-mesh-generator",n["a"]),new s["bb"]("rapi-access",s["cb"]),new s["bb"]("roomle-material-viewer-ui-callback",class extends r["b"]{constructor(e){super(e),this.onMaterialShadingChanged=e=>{}}},1)];class c extends a["i"]{setupGlobals(){}setupDependencies(){s["gb"].setup(l),this.lookup("logger",this._context)}cleanUpGlobals(){throw new Error("Method not implemented.")}cleanUpDependencies(){throw new Error("Method not implemented.")}bootFinished(){this._viewer=new _(this._context),window.RoomleMaterialViewer||(window.RoomleMaterialViewer=this._viewer)}getApi(){return this._viewer}getContextName(){return"material-viewer"}}},a942:function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var s=i("12df"),a=i("ea7d");class r extends a["a"]{constructor(e){super(e),this._geometryComponentMaterialCache=new Map,this._configuratorPreviewMaterial=new THREE.MeshStandardMaterial({color:s["l"],transparent:!0,opacity:s["o"],roughness:s["p"],envMap:null}),this._environmentLoader.setEnvMap(this._configuratorPreviewMaterial)}generateMesh(e=0,t=null,i,s,a,r,n,o=!1){let h;h=o?this._generateGeometry(t,s,a,r,n).clone():this._generateGeometry(t,s,a,r,n);const _=this._createMesh(e,t,h);return _.layers.set(3),i&&this.materialQueue.push(this._assignMaterial(_,i).then(()=>{e&&t&&this._geometryComponentMaterialCache.set(this._getComponentMeshId(e,t),i),this._materialLoaded&&this._materialLoaded()})),_}_createMesh(e,t,i){if(e&&t){const s=this._getComponentMeshId(e,t);if(this._geometryComponentMaterialCache.has(s)){const e=this._geometryComponentMaterialCache.get(s);if(this._cacheHolder.materialCache.has(e)){const t=this._cacheHolder.materialCache.get(e);return new THREE.Mesh(i,t)}}}return new THREE.Mesh(i,this._configuratorPreviewMaterial.clone())}_getComponentMeshId(e,t){return e+"_"+t}setMaterial(e,t,i){this._assignMaterial(e,t).then(()=>{this._materialLoaded&&this._materialLoaded()})}loadMaterial(e,t,i){return super._loadMaterial(e,t,i)}loadTextures(e,t,i,s){return super._loadTextures(e,t,i,s)}}},d1a4:function(e,t,i){"use strict";i.d(t,"a",(function(){return r})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return o}));var s=i("12df"),a=i("2354");class r extends a["q"]{constructor(e,t,i){super(e,t,i),this._scale=1,this._state=0,this._size=20,this._center=new THREE.Vector3,this._raycaster=new THREE.Raycaster,this._lastPosition=new THREE.Vector2,this._zoomPosition=new THREE.Vector3,this._lastZoom=0,this._zoomSpeed=Math.pow(.95,2),this._cameraZoom=1,this._initCamera(i||new THREE.Vector3(0,10,0));let s=new THREE.PlaneGeometry(1e3,1e3);s.rotateX(-Math.PI/2),this._plane=new THREE.Mesh(s,new THREE.MeshStandardMaterial)}_getCamera(){return this._camera||this._initCamera(new THREE.Vector3(0,10,0)),this._camera}_initCamera(e){let{x:t,y:i}=this._domHelper.getClientDimensions(),s=t/i*this._size,a=this._size;this._camera=new THREE.OrthographicCamera(s/-2,s/2,a/2,a/-2,1,1e3),this._camera.position.copy(e),this._cameraPosition=e,this._camera.lookAt(new THREE.Vector3(0,0,0))}updateCamera(){let{x:e,y:t}=this._domHelper.getClientDimensions(),i=e/t*this._size,s=this._size;this._camera.left=i/-2,this._camera.right=i/2,this._camera.top=s/2,this._camera.bottom=s/-2,this._camera.updateProjectionMatrix()}_initInputListener(){this._inputListeners.push({key:3,fun:e=>{this._locked||(this._state=1,this._lastPosition.set(e.position.x,e.position.y),this.dispatchEvent(0))}}),this._inputListeners.push({key:6,fun:e=>{1!==this._state||this._locked||(this._move(new THREE.Vector2(e.position.x,e.position.y),e.type),this.dispatchEvent(1))}}),this._inputListeners.push({key:4,fun:e=>{1===this._state&&this.dispatchEvent(2),this._state=0}}),this._inputListeners.push({key:7,fun:e=>{e.event&&(e.event.stopPropagation(),e.event.preventDefault()),this._scale/=this._zoomSpeed,this._zoomTo(e.position,1),this._update()}}),this._inputListeners.push({key:8,fun:e=>{e.event&&(e.event.stopPropagation(),e.event.preventDefault()),this._scale*=this._zoomSpeed,this._zoomTo(e.position,-1),this._update()}})}_zoomTo(e,t){if(Date.now()-this._lastZoom>200){if(t>0||this._cameraZoom>=1){const t=this.getInputPosition(e);this._raycaster.setFromCamera(t,this._camera);const i=this._raycaster.intersectObject(this._plane);if(i.length<=0)return;const s=i.pop().point;this._zoomPosition.copy(s)}else this._zoomPosition.copy(this._center);this._cameraPosition.x=this._zoomPosition.x,this._cameraPosition.z=this._zoomPosition.z}this._lastZoom=Date.now()}_move(e,t){let i=new THREE.Vector2;i.subVectors(this._lastPosition,e),i.divideScalar(100),this._cameraPosition.x+=i.x*(2===t?1.1:1),this._cameraPosition.z+=i.y*(2===t?1.1:1),this._lastPosition.copy(e)}updateToBounds(e,t){let{x:i,y:s}=this._domHelper.getClientDimensions(),a=i/s;this._size=Math.max(e.x,e.z);let r=this._size,n=this._size;a>1?r=this._size*a:n=this._size*(s/i),this._center.copy(t),this._camera.left=r/-2,this._camera.right=r/2,this._camera.top=n/2,this._camera.bottom=n/-2,this._camera.zoom=1,this._camera.position.set(this._center.x,10,this._center.z),this._cameraPosition.copy(this._camera.position)}_update(e){this._scale=Math.min(this._scale,5),this._scale=Math.max(this._scale,.8),this._cameraZoom=this._scale,this._camera.updateProjectionMatrix()}animateCamera(e){return!(!super.animateCamera(e)&&Math.abs(this._cameraZoom-this._camera.zoom)<=.01||(this._camera.zoom=THREE.MathUtils.lerp(this._camera.zoom,this._cameraZoom,10*e),0))}}const n=Math.PI/4;class o extends a["q"]{constructor(e,t,i,a){super(e,t,i),this._state=0,this._rotationSpeed=1,this._keyMap=new Map,this.minPolarAngle=Object(s["jb"])(-60),this.maxPolarAngle=Object(s["jb"])(60),this._camera=a||new THREE.PerspectiveCamera,this._camera.fov=70,this._camera.aspect=this._width/this._height,this._camera.near=.1,this._camera.far=100,this._camera.updateProjectionMatrix(),this._camera.layers.set(3),this._camera.layers.enable(1),this._camera.layers.enable(2),this._camera.layers.enable(5),this._camera.layers.enable(4),i?this._camera.position.set(i.x,1.5,i.z):this._camera.position.set(0,1.5,0),this._cameraPosition=new THREE.Vector3,this._cameraPosition.copy(this._camera.position),this._cameraRotation=new THREE.Quaternion,this._pitch=0,this._yaw=0;let r=new THREE.Euler(-this._pitch,this._yaw,0,"ZYX");this._cameraRotation.setFromEuler(r),window.addEventListener("gamepadconnected",this._gamepadConnected.bind(this)),window.addEventListener("gamepaddisconnected",this._gamepadDisconnected.bind(this))}_gamepadConnected(e){this.startButtonPressListener()}_gamepadDisconnected(e){window.cancelAnimationFrame(this._listenerLoopAnimationFrame)}startButtonPressListener(){this._listenerLoopAnimationFrame=window.requestAnimationFrame(()=>{this.buttonPressListener()})}buttonPressListener(){let e=navigator.getGamepads()[0];this._checkRightStick(e),this._checkLeftStick(e),this._checkButtons(e),this._processKeyMap(this._keyMap,.001),this.startButtonPressListener()}_checkRightStick(e){let t=e.axes[2],i=e.axes[3];Math.abs(t)>.2&&(this._rotateHorizontal(.01*n*t),this._update(),this.dispatchEvent(1)),Math.abs(i)>.2&&(this._rotateVertical(.01*n*i),this._update(),this.dispatchEvent(1))}_checkLeftStick(e){let t=e.axes[0],i=e.axes[1];Math.abs(i)>.2?i<0?this._keyMap.set(87,!0):this._keyMap.set(83,!0):e.buttons&&e.buttons[12]&&e.buttons[12].pressed?this._keyMap.set(87,!0):e.buttons&&e.buttons[13]&&e.buttons[13].pressed?this._keyMap.set(83,!0):(this._keyMap.set(87,!1),this._keyMap.set(83,!1)),Math.abs(t)>.2?t<0?this._keyMap.set(65,!0):this._keyMap.set(68,!0):(this._keyMap.set(65,!1),this._keyMap.set(68,!1))}_checkButtons(e){e.buttons&&e.buttons[6]&&e.buttons[6].pressed?this._keyMap.set(16,!0):this._keyMap.set(16,!1),e.buttons&&e.buttons[14]&&e.buttons[14].pressed?(this._keyMap.set(37,!0),this.dispatchEvent(1)):this._keyMap.set(37,!1),e.buttons&&e.buttons[15]&&e.buttons[15].pressed?(this._keyMap.set(39,!0),this.dispatchEvent(1)):this._keyMap.set(39,!1)}animateCamera(e){let t=this._cameraPosition,i=this._cameraRotation,a=this.getCamera(),r=Object(s["hb"])(t,a.position),n=Object(s["I"])(i,a.quaternion);if(!t||r&&n)return!1;let o=this.getCamera().position.clone(),h=Math.min(10*e,1);o.lerp(t,h),this.getCamera().position.copy(o);let _=this.getCamera().quaternion.clone(),l=Math.min(5*e,1);_.slerp(i,l),this.getCamera().setRotationFromQuaternion(_);let c=!1;return this._keyMap.forEach(e=>{e&&(c=!0)}),c&&this._processKeyMap(this._keyMap,e),!0}_getCamera(){return this._camera}_initInputListener(){window.addEventListener("keyup",this._onKeyChanged.bind(this),!1),window.addEventListener("keydown",this._onKeyChanged.bind(this),!1),this._inputListeners.push({key:3,fun:e=>{this._down(e)}}),this._inputListeners.push({key:6,fun:e=>{this._move(e)}}),this._inputListeners.push({key:4,fun:e=>{this._up(e)}})}_down(e){this._downPosition=e.position,this._position=e.position,this._state=1,2===e.type&&window.setTimeout(this._onLongDown.bind(this),350),2===e.type?this._rotationSpeed=.6:this._rotationSpeed=1}_move(e){this._position=e.position,1!==this._state||this._locked||this._orbit(new THREE.Vector2(e.position.x,e.position.y)),2!==this._state||this._locked||(this._orbit(new THREE.Vector2(e.position.x,e.position.y)),this._moveForward())}_up(e){1===this._state&&this.dispatchEvent(2),2===this._state&&this._keyMap.set(87,!1),this._state=0,this._orbitPosition=null}_onLongDown(){Object(s["J"])(this._downPosition,this._position)<a["w"]&&1===this._state&&(this._state=2,this._orbit(new THREE.Vector2(this._position.x,this._position.y)),this._moveForward())}_update(e){let t=new THREE.Euler(-this._pitch,this._yaw,0,"ZYX");this._cameraRotation.setFromEuler(t)}updateCamera(){let{x:e,y:t}=this._domHelper.getClientDimensions();this._camera.aspect=e/t,this._camera.updateProjectionMatrix()}_onKeyChanged(e){this._keyMap.set(e.keyCode,"keydown"===e.type),this.dispatchEvent(6),this._processKeyMap(this._keyMap,.001)&&e.preventDefault()}_processKeyMap(e,t){t=Math.min(t,.1);let i=new THREE.Vector3(0,0,0),s=!1;return this._processUpDown(e,i,t),e.get(65)&&(i.x=-1*t),e.get(68)&&(i.x=1*t),e.get(37)&&(this._rotateHorizontal(-n*this._rotationSpeed*t),s=!0),e.get(39)&&(this._rotateHorizontal(n*this._rotationSpeed*t),s=!0),e.get(16)&&(i.x*=3,i.z*=3),!(0===i.x&&0===i.y&&0===i.z&&!s||(i.applyQuaternion(this.getCamera().quaternion),this._cameraPosition.add(new THREE.Vector3(i.x,0,i.z)),this._update(),0))}_processUpDown(e,t,i){(e.get(87)||e.get(38))&&(t.z=-1*i),(e.get(83)||e.get(40))&&(t.z=1*i)}_orbit(e){this._orbitPosition||(this._orbitPosition=new THREE.Vector2(e.x,e.y),this.dispatchEvent(0));let t=e.clone().sub(this._orbitPosition),i=this._domHelper.element instanceof Document?this._domHelper.element.body:this._domHelper.element;t.multiplyScalar(-1),this._rotateHorizontal(2*Math.PI*t.x/i.clientWidth*1),this._rotateVertical(2*Math.PI*t.y/i.clientHeight*1),Object(s["ib"])(this._orbitPosition,e)||this.dispatchEvent(1),this._orbitPosition.copy(e),this._update()}_moveForward(){this._keyMap.set(87,!0),this._processKeyMap(this._keyMap,.001)}_rotateVertical(e){let t=this._pitch+e;t>this.maxPolarAngle||t<this.minPolarAngle||(this._pitch=t,this._pitch<-Math.PI?this._pitch+=2*Math.PI:this._pitch>Math.PI&&(this._pitch-=2*Math.PI),this._saveYawAndPitch())}}let h=(()=>{class e{constructor(e,t,i,s,a){this._maxAnisotropy=1,this._clock=new THREE.Clock,this._delta=0,this._renderListener=null,this._stopRendering=!1,this._forceRender=!1,this._lastChange=Date.now(),this._running=!1,this._onAfterRender=()=>{},this._creator_=e,this._canvasID=i,this.createCameraControl(s),this._addCameraControlListener(),this._setupScene(t,a),document.addEventListener("visibilitychange",this._tabVisible.bind(this)),this._renderListener=()=>{this._requestRender(!0)},this._getInputManager().addEventListener(7,this._renderListener,this),this._getInputManager().addEventListener(8,this._renderListener,this),this._lifeCycleManager.addEventListener(this)}onBeforeRender(){}_changeCameraControl(e){this._cameraControl&&this._cameraControl.cleanUp(),e instanceof o&&(this._getInputManager().removeEventListener(7,this._renderListener),this._getInputManager().removeEventListener(8,this._renderListener)),this._cameraControl instanceof o&&(this._getInputManager().addEventListener(7,this._renderListener,this),this._getInputManager().addEventListener(8,this._renderListener,this)),this._cameraControl=e,this.cameraControlChanged()}cameraControlChanged(){}_addCameraControlListener(){this._cameraControl.addEventListener(0,this._requestRender,this),this._cameraControl.addEventListener(1,this._requestRender,this),this._cameraControl.addEventListener(2,this._requestRender,this),this._cameraControl.addEventListener(6,this._requestRender,this)}_requestRender(e){if(!this._renderer)return;this._pixotron&&(this._pixotron.needsUpdate=!0,e&&(this._forceRender=!0));const t=()=>{this._delta=this._clock.getDelta(),this._animateCamera(),this._cameraControl.getCamera().layers.mask=65535,this._renderLoopFunction&&(this._renderLoopFunction(),this._renderLoopFunction=null),this.onBeforeRender(),this._statsHelper&&this._statsHelper.updateRenderInfo(this._renderer.info),this._pixotron?(this._forceRender&&(this._pixotron.autoShadowsClear=!0,this._pixotron.autoSAOClear=!0),this._pixotron.render(this._renderer,this._scene,this._cameraControl.getCamera(),this._renderTarget),this._forceRender=!1,this._pixotron.blit()):(this._renderer.clear(),this._renderer.render(this._scene,this._cameraControl.getCamera()),this._renderer.clearDepth()),this._onAfterRender(),window.TWEEN&&TWEEN.update(),this._lastChange+3e3<Date.now()||this._stopRendering?this._running=!1:(this._running=!0,requestAnimationFrame(t))};this._lastChange=Date.now(),this._running||this._stopRendering||(this._running=!0,requestAnimationFrame(t))}_animateCamera(){this._cameraControl&&(this._cameraControl.animateCamera(this._delta)||!this._pixotron||this._forceRender?(this._lightSetting instanceof a["c"]&&this._cameraControl.getCamera()instanceof THREE.PerspectiveCamera&&this._lightSetting.update(this._cameraControl.getCamera(),this._cameraControl.getTargetPosition()),this._pixotron&&(this._pixotron.needsUpdate=!0)):(this._pixotron.autoShadowsClear=!1,this._pixotron.autoSAOClear=!1)),this._environment&&this._environment.needsCamera()&&this._cameraControl instanceof a["b"]&&this._environment.updateCamera(this._cameraControl.getCamera())}_setupScene(e,t){const{x:i,y:s}=this._domHelper.getClientDimensions();this._scene=new THREE.Scene,(t=t||!1)||(this._scene.background=new THREE.Color(this._initData.colors.DEFAULT_BACKGROUND)),THREE.Math={DEG2RAD:THREE.MathUtils.DEG2RAD};const a={format:THREE.RGBAFormat,minFilter:THREE.NearestFilter,magFilter:THREE.NearestFilter},r=THREE.sRGBEncoding,n=Math.floor(i*window.devicePixelRatio),o=Math.floor(s*window.devicePixelRatio);this._renderTarget=new THREE.WebGLRenderTarget(n,o,a),this._renderTarget.texture.encoding=r,this._renderer=new THREE.WebGLRenderer({antialias:!0,alpha:!0}),this._renderer.setPixelRatio(window.devicePixelRatio),this._renderer.setSize(i,s),this._renderer.outputEncoding=THREE.sRGBEncoding,this._renderer.gammaFactor=2.2,this._renderer.autoClear=!1,this._renderer.shadowMap.enabled=!0,this._renderer.shadowMap.type=THREE.PCFSoftShadowMap,this._maxAnisotropy=this._renderer.capabilities.getMaxAnisotropy(),this._renderer.domElement.classList.add(this._canvasID),this._domHelper.element.appendChild(this._renderer.domElement),this._getInputManager().addEvents(this._renderer.domElement),this._environmentLoader.setRendererAndScene(this._renderer,this._scene),this._environmentLoader.registerEnvironmentChangedCallback(()=>this._requestRender(!0)),this._requestRender(),window.addEventListener("resize",this,!1),window.addEventListener("keydown",this,!1),window.addEventListener("keyup",this,!1),this.sceneChanged()}_tabVisible(e){this.updateCamera(),this._requestRender(!0)}setupScene(e,t){this._setupScene(e,t)}updateCamera(){const{x:e,y:t}=this._domHelper.getClientDimensions();this._renderer.setSize(e,t);const i=this._renderer.getPixelRatio();if(this._renderTarget){const s=Math.floor(e*i),a=Math.floor(t*i);this._renderTarget.setSize(s,a)}if(this._pixotron){this._pixotron.autoShadowsClear=!0,this._pixotron.autoSAOClear=!0,this._forceRender=!0;try{this._pixotron.setSize(e,t)}catch(e){console.warn(e)}}this._cameraControl.updateCamera(),this._requestRender(!0)}_onWindowResize(){this.updateCamera(),this._requestRender(!0)}_isPartOfScene(e){return"Object3D"===e.type||"Mesh"===e.type||"GLB"===e.type||"GLTF"===e.type||"Group"===e.type}cleanUp(){this._getInputManager().removeEventListener(7,this._renderListener),this._getInputManager().removeEventListener(8,this._renderListener),this._cameraControl&&this._cameraControl.cleanUp()}clearScene(){let e=[];this._scene.children.forEach(t=>{this._isPartOfScene(t)&&e.push(t)}),e.forEach(e=>{Object(s["T"])(e),this._scene.remove(e)}),this._renderer.renderLists.dispose()}enableHD(){this._pixotron=new window.PIXOTRON.Pixotron(this.getPixotronParams()),this._pixotronUtil=new a["o"](this._pixotron),this._environment instanceof a["a"]&&(this._environment.setPixotron(this._pixotron,this._renderer,this._cameraControl.getCamera(),this.getBakedShadowParams()),this._environment.setLoadedCallback(()=>setTimeout(()=>this._requestRender(!0),500))),this._requestRender()}_loadGLTF(e,t,i,s,a,r,n){return new Promise((o,h)=>{this._staticItemLoader.loadGLTF(e,t,i,s,a,r,null,n).then(e=>{this._setCamera("GLTF",e),o(e)},h)})}_loadGLB(e,t,i,s,a,r,n,o){return new Promise((h,_)=>{this._staticItemLoader.loadGLB(e,t,i,s,a,r,n,o).then(e=>{this._setCamera("GLB",e),h(e)},_)})}_setCamera(e,t){if(!t)return void console.warn("could not set camera for gltf",t);const i=new THREE.Box3;if(i.setFromObject(t),"GLB"===e)this._cameraControl instanceof a["b"]&&this._cameraControl.updateToBounds(i,window.innerWidth,window.innerHeight,!1);else if("GLTF"===e){if(this._cameraControl instanceof a["b"]){let{x:e,y:t}=this._domHelper.getClientDimensions();this._cameraControl.updateAndReset(i.getSize(new THREE.Vector3),e,t,i.getCenter(new THREE.Vector3),-15,70,5,!1)}this._cameraControl instanceof r&&this._cameraControl.updateToBounds(i.getSize(new THREE.Vector3),i.getCenter(new THREE.Vector3))}this.updateCamera()}showGUI(){if(this._initData.disableDebugGUI)return;const e=document.createElement("style");e.innerText=".dg.main{position:absolute;z-index:100;top:0;left:0;}",document.head.appendChild(e),this._scriptLoader.fetch(a["t"],{id:"dat-gui-js"}).then(()=>{let e=Object(s["V"])(!1);e&&(this._domHelper.element.appendChild(e.domElement),this._guiLoaded())},e=>console.error(e))}_guiLoaded(){let e=Object(s["V"])();e&&(this._lightSetting&&this._lightSetting.showGUI(),this._pixotron&&this._pixotronUtil.showGUI(),this._environment&&this._environment.showGUI(),this._addGUIListener(e))}_addGUIListener(e){let t=e.__folders;Object.keys(t).forEach(e=>{let i=t[e];i.__folders&&Object.keys(i.__folders).forEach(e=>{let i=t[e];this._addGUIListener(i)}),i.__controllers&&i.__controllers.forEach(e=>{e.onFinishChange(()=>{this._guiParamChanged()})})})}_guiParamChanged(){this._requestRender()}showStats(){i.e("chunk-2d0b16c2").then(i.bind(null,"207e")).then(e=>this._statsHelper=new e.default)}_onKeyDown(e){}_onKeyUp(e){}pause(){this._getInputManager().removeEvents(this._renderer.domElement),window.removeEventListener("resize",this,!1),window.removeEventListener("keydown",this,!1),window.removeEventListener("keyup",this,!1)}resume(){this.updateCamera(),this._renderer.domElement.classList.add(this._canvasID),this._domHelper.element.appendChild(this._renderer.domElement),this._getInputManager().addEvents(this._renderer.domElement),window.addEventListener("resize",this,!1),window.addEventListener("keydown",this,!1),window.addEventListener("keyup",this,!1),this._requestRender(!0)}destroy(){this.pause(),this.cleanUp()}handleEvent(e){switch(e.type){case"resize":this._onWindowResize();break;case"keydown":this._onKeyDown(e);break;case"keyup":this._onKeyUp(e)}}loadSceneSettings(e){let t,i;return t=e.environment?new Promise(t=>{(new a["p"]).load(this._scene,this._renderer.domElement,this._environment,e).then(e=>{this._setEnvironment(e),t()})}):Promise.resolve(),e.lights?(this._lightSetting=new a["c"](this._scene,this._lightSetting),i=this._lightSetting.loadFromObject(e)):i=Promise.resolve(),new Promise((e,s)=>{Promise.all([t,i]).then(()=>{this._requestRender(!0),e()},s)})}_setEnvironment(e){this._environment=e,this._pixotron&&this._environment instanceof a["a"]&&(this._environment.setPixotron(this._pixotron,this._renderer,this._cameraControl.getCamera(),this.getBakedShadowParams()),this._environment.setLoadedCallback(()=>setTimeout(()=>this._requestRender(!0),500)))}loadQualitySetting(e){this._pixotron&&(new s["K"]).set(this._pixotron,e)}async loadDynamicLightSetting(e){this._lightSetting=new a["c"](this._scene,this._lightSetting);let t=!1;if(e.url)await this._lightSetting.loadFromURL(e.url),t=!0;else if(e.json)await this._lightSetting.loadFromJSON(e.json),t=!0;else if(e.object)await this._lightSetting.loadFromObject(e.object),t=!0;else if(e.ls){const i=s["U"].createDynamicLightSettingSource(null,e.ls);await this._lightSetting.loadFromURL(i.url),t=!0}if(!t)throw new Error("No dynamic light setting source set");this._requestRender(!0)}getScene(){return this._scene}updateScene(){this._updateBounds(this.getBounds()),this._requestRender(!0)}_updateBounds(e){if(e){if(this.updateEnvironment(e),this._lightSetting&&this._lightSetting.needsBounds()&&this._lightSetting.updateBounds(e),this._pixotronUtil){const t=new THREE.Sphere;e.getBoundingSphere(t),this._pixotronUtil.updateBounds(t)}this._requestRender(!0)}}setCameraOffset(e){const t=this._cameraControl.getCamera();t.offset?(t.offset=e,this._requestRender(!0)):console.warn("Cannot set offset, current camera does not support it")}getCameraOffset(){const e=this._cameraControl.getCamera();return e.offset?JSON.parse(JSON.stringify(e.offset)):{left:0,top:0,right:1,bottom:1}}getPerspectiveOffsetCamera(){const e=this._domHelper.getClientDimensions(),t=e.x,i=e.y;return Object(s["s"])().createCamera(30,t/i,.1,20)}updateEnvironment(e,t=!1){e&&this._environment&&this._environment.needsBounds()&&this._environment.updateBounds(e.getSize(new THREE.Vector3),t)}}return Object(s["B"])([s["Y"]],e.prototype,"_domHelper",void 0),Object(s["B"])([s["Y"]],e.prototype,"_scriptLoader",void 0),Object(s["B"])([s["Y"]],e.prototype,"_lifeCycleManager",void 0),Object(s["B"])([s["Y"]],e.prototype,"_staticItemLoader",void 0),Object(s["B"])([s["Y"]],e.prototype,"_environmentLoader",void 0),Object(s["B"])([s["Y"]],e.prototype,"_initData",void 0),e})()},ea7d:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return o}));var s=i("12df"),a=i("4a09");class r{constructor(e,t){this._waitingPromises=[],this._errorCallback=()=>{},Promise.allSettled=Promise.allSettled||(e=>Promise.all(e.map(e=>e.then(e=>({status:"fulfilled",value:e})).catch(e=>({status:"rejected",reason:e}))))),e&&this.registerCallback(e),t&&(this._errorCallback=t)}push(e){this._waitingPromises.push(e),Promise.all(this._waitingPromises).then(e=>{e.length===this._waitingPromises.length&&this._callback&&(this._callback(e),this._waitingPromises=[])},this._errorCallback)}finished(e=!1){return new Promise((t,i)=>{const s=e?"allSettled":"all";Promise[s](this._waitingPromises).then(e=>{if("allSettled"===s){const i=[];e.forEach(({value:e,status:t})=>{"fulfilled"===t&&i.push(e)}),t(i)}else t(e)},e=>{i(e)})})}registerCallback(e){this._callback=e}unregisterCallback(){this._callback=null}get length(){return this._waitingPromises.length}}let n=(()=>{class e{constructor(e){this.materialQueue=new r,this._maxAnisotropy=1,this._maxTextures=16,this._textureLoader=new THREE.TextureLoader,this._creator_=e,this._previewMaterial=new THREE.MeshStandardMaterial({color:s["l"],roughness:s["p"],metalness:s["r"]}),this._environmentLoader.setEnvMap(this._previewMaterial)}_generateGeometry(e,t,i,s,a){let r;if(e&&this._cacheHolder.geometryCache.has(e))r=this._cacheHolder.geometryCache.get(e);else{r=new THREE.Geometry,r.faceVertexUvs=[],r.faceVertexUvs[0]=[];for(let e=0,i=t.length;e<i;e+=3)r.vertices.push(new THREE.Vector3(t[e]/1e3,t[e+2]/1e3,t[e+1]/-1e3));let n=0,o=0,h=0,_=0,l=0,c=0,d=0,m=0,p=0,u=0,g=[];for(let e=0,t=i.length;e<t;e+=3)o=e,h=e+1,_=e+2,l=3*i[o],c=3*i[h],d=3*i[_],g=[new THREE.Vector3(a[l],a[l+2],-1*a[l+1]),new THREE.Vector3(a[c],a[c+2],-1*a[c+1]),new THREE.Vector3(a[d],a[d+2],-1*a[d+1])],r.faces.push(new THREE.Face3(i[o],i[h],i[_],g)),m=2*i[o],p=2*i[h],u=2*i[_],r.faceVertexUvs[0][n]=[],r.faceVertexUvs[0][n][0]=new THREE.Vector2(s[m],s[m+1]),r.faceVertexUvs[0][n][1]=new THREE.Vector2(s[p],s[p+1]),r.faceVertexUvs[0][n][2]=new THREE.Vector2(s[u],s[u+1]),n++;e&&this._cacheHolder.geometryCache.set(e,r)}return r}changeMaterialOfMesh(e,t){e&&t?(e.material=t,e.material.transparent||0===e.material.opacity||e.material.transmission>0?(e.castShadow=!1,e.receiveShadow=!1):(e.castShadow=!0,e.receiveShadow=!0),e.material.needsUpdate=!0):console.warn("could not assign material to mesh",{mesh:e},{material:t})}_createMaterial(e,t,i,r,n){if(this._cacheHolder.materialCache.has(e))t();else if(e.startsWith("benchmarkMaterial")){let o=Object(a["e"])(e),h=Object(s["i"])(o,this._environmentLoader);this._loadBenchmarkTextures(o,h,r,n).then(t,i)}else this._rapiAccess.getMaterial(e).then(e=>{let a=Object(s["i"])(e,this._environmentLoader);this._loadTextures(e,a,r,n).then(t,i)},i)}_loadBenchmarkTextures(e,t,i=1,r=1){return new Promise((n,o)=>{const h=Object(a["g"])(e.id);Object(s["k"])(this._dataSyncer.requestAsset(h.image,!0),h,t,this._maxAnisotropy,i/(0===h.mmWidth?1:h.mmWidth),r/(0===h.mmHeight?1:h.mmHeight),this._maxTextures).then(()=>{this._cacheHolder.materialCache.set(e.id,t),n()},o)})}_loadTextures(e,t,i=1,a=1){return new Promise((r,n)=>{if(!e.textures||e.textures&&0===e.textures.length)return this._cacheHolder.materialCache.set(e.id,t),r();this._rapiAccess.getTexturesOf(e).then(o=>{let h=[];o.forEach(e=>{h.push(Object(s["k"])(this._dataSyncer.requestAsset(e.image,!0),e,t,this._maxAnisotropy,i/(0===e.mmWidth?1:e.mmWidth),a/(0===e.mmHeight?1:e.mmHeight),this._maxTextures))}),Promise.all(h).then(()=>{this._cacheHolder.materialCache.set(e.id,t),r()},n)})})}_loadMaterial(e,t,i){return new Promise((s,a)=>{this._singlePromiseFactory.create(6,e,(s,a)=>this._createMaterial(e,s,a,t,i)).then(()=>{setTimeout(()=>s(this._cacheHolder.materialCache.get(e)),0)},a)})}_assignMaterial(e,t){return this._cacheHolder.materialCache.has(t)?(this.changeMaterialOfMesh(e,this._cacheHolder.materialCache.get(t)),Promise.resolve()):new Promise((i,s)=>{this._loadMaterial(t).then(t=>{this.changeMaterialOfMesh(e,t),i()},s)})}get maxAnisotropy(){return this._maxAnisotropy}set maxAnisotropy(e){this._maxAnisotropy=e}get maxTextures(){return this._maxTextures}set maxTextures(e){this._maxTextures=e}clear(){this._cacheHolder.clear()}_assignRGB(e,t){return new Promise(i=>{let s,a="rbg"+JSON.stringify(t);this._cacheHolder.materialCache.has(a)?s=this._cacheHolder.materialCache.get(a):(s=new THREE.MeshStandardMaterial({color:t}),this._environmentLoader.setEnvMap(s),this._cacheHolder.materialCache.set(a,s)),this.changeMaterialOfMesh(e,s),setTimeout(()=>i(),0)})}_assignItem(e,t){return new Promise((i,s)=>{if(this._cacheHolder.materialCache.has(t))return this.changeMaterialOfMesh(e,this._cacheHolder.materialCache.get(t)),void i();this._rapiAccess.getItem(t).then(a=>{if(a.topImage)this._textureLoader.load(a.topImage,s=>{s.anisotropy=this._maxAnisotropy,s.wrapS=THREE.RepeatWrapping,s.wrapT=THREE.RepeatWrapping;let r=new THREE.Vector2(1,1);a.width>0&&(r.x=1/a.width),a.depth>0&&(r.y=1/a.depth),s.repeat.set(r.x,r.y);const n=new THREE.MeshPhysicalMaterial({map:s,roughness:.5,metalness:.1});this._environmentLoader.setEnvMap(n),this._cacheHolder.materialCache.set(t,n),this.changeMaterialOfMesh(e,n),setTimeout(()=>i(),0)});else{const e="can not set material, catalog item top image is not set";console.warn(e),s(e)}},s)})}_generateMesh(e=0,t=null,i,s,a,r,n,o=!1){return this._plannerMeshGenerator.generateMesh(t,i,s,a,r,n)}setMaterialLoadedListener(e){this._materialLoaded=e}removeMaterialLoadedListener(){this._materialLoaded=void 0}}return Object(s["B"])([s["Y"]],e.prototype,"_rapiAccess",void 0),Object(s["B"])([s["Y"]],e.prototype,"_environmentLoader",void 0),Object(s["B"])([s["Y"]],e.prototype,"_dataSyncer",void 0),Object(s["B"])([s["Y"]],e.prototype,"_singlePromiseFactory",void 0),Object(s["B"])([s["Y"]],e.prototype,"_cacheHolder",void 0),Object(s["B"])([s["Y"]],e.prototype,"_plannerMeshGenerator",void 0),e})();class o{constructor(e){return this._isMute=!1,this._creator_=e,Object(a["h"])(this,"_isMute",{enumerable:!1,writable:!1}),Object(a["h"])(o.prototype,"_setMute",{enumerable:!1,writable:!1}),Object(a["h"])(o.prototype,"mute",{enumerable:!1,writable:!1}),Object(a["h"])(o.prototype,"unmute",{enumerable:!1,writable:!1}),new Proxy(this,this)}_setMute(e){Object(a["k"])(this,"_isMute",!0),this._isMute=e,Object(a["k"])(this,"_isMute",!1)}mute(){this._setMute(!0)}unmute(){this._setMute(!1)}get(e,t){return this._isMute&&"function"==typeof this[t]&&"on"===t.substr(0,2)?()=>{}:this[t]}}}}]);
//# sourceMappingURL=chunk-3cdbd03f-legacy.bfa0a09e.js.map