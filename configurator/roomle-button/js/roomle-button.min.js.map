{"version":3,"sources":["roomle-button.min.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","controllers","SettingsService_1","EventHandlerService_1","ButtonsService_1","DomBuilderService_1","MobileRedirectService_1","MobileDetectService_1","ConsoleService_1","RoomleTypeService_1","ImagesService_1","TrackingService_1","CONF_ID_PLACEHOLDER","RoomleButton","settings","this","domBuilder","trackingService","imagesService","eventHandler","mobileRedirectService","mobileDetectService","SettingsService","init","DomBuilderService","inject","TrackingService","ImagesService","EventHandlerService","MobileRedirectService","MobileDetectService","trackGA","preloadImages","_addCSS","_boot","prototype","head","document","getElementsByTagName","styleHref","cssPath","scriptId","script","getElementById","href","getAttribute","replace","substr","style","createElement","rel","media","cssSkipIntegrity","setAttribute","appendChild","_setupClickListener","container","_this","addEventListener","handle","controllerClasses","element","body","addCSS","elementList","querySelectorAll","createPopUp","buildPopUp","instanceSelector","selector","key","hasOwnProperty","mode","controllerClass","parse","openCustomPopUp","content","parent","buildCustomPopUp","setTimeout","dispatchOpenPopUp","dispatchClick","id","type","buttonType","highlight","trackGAInteraction","dispatch","ButtonsService","convertButtonTypeToEnum","getDomLinkFor","action","isHighlighted","callbackUrl","roomleType","RoomleTypeService","convertTypeToEnum","link","generateLink","buildOptions","buildAnyway","buildLink","appendButtons","links","getLinks","forEach","execDeeplink","clickedButton","newWindow","callback","wasDeviceSwitch","ROOMLE_TYPE","ITEM","indexOf","ConsoleService","error","alternate","event_1","createEvent","initEvent","BUTTON_TYPE","TRIGGER","redirect","redirectTo","useTimeout","redirectToStore","getInstance","_instance","window","RoomleButtonInstance","rmlObject","Object","getPrototypeOf","exposedObject","_loop_1","args","_i","arguments","apply","booted","./controllers/Controllers","./services/ButtonsService","./services/ConsoleService","./services/DomBuilderService","./services/EventHandlerService","./services/ImagesService","./services/MobileDetectService","./services/MobileRedirectService","./services/RoomleTypeService","./services/SettingsService","./services/TrackingService","2","Environments_1","LIVE_BASE_URL","Environment","gaPath","rapi","protocol","rmlco","shortlink","button","shortId","baseUrl","baseServer","gaUrl","env","Environments","TEST","alphaBaseUrl","productionBaseUrl","testBaseUrl","settingsOverride","RoomleButtonSettings","location","defineProperty","get","envIndicator","substring","enumerable","configurable","./Environments","3","PRODUCTION","ALPHA","4","RoomleController_1","RoomleController","PopupController_1","PopupController","./PopupController","./RoomleController","5","__extends","d","b","__","constructor","p","create","Controller_1","_super","eventHandlerService","domBuilderService","subscribe","EVENT_TYPES","openPopup","bind","POP_UP_OPEN","simpleOpen","POP_UP_CLOSE","closePopup","$","showBackButton","back","classList","add","adjustWrapperCss","wrapper","contains","remove","unfreezeScrolling","popUp","popUpSelector","removeAttribute","popupClose","freezeScrolling","linksContainer","hintContainer","innerHTML","hintText","text","preventDefault","modal","scrollTop","popupOpen","slide","linkDom","slideMode","clickedHint","imgContainer","dom","img","imgUrl","images","querySelector","domLink","cloneNode","hint","addShortlink","newlinkDom","input","select","html","position","top_1","innerWidth","offsetWidth","overflowY","width","height","top","scrollTopValue","parseInt","Controller","../lib/Controller","../services/DomBuilderService","../services/EventHandlerService","../services/ImagesService","../services/SettingsService","../services/TrackingService","6","idSelector","dataSelector","typeSelector","addButtons","createNoButtons","item","buttons","getButtons","../services/RoomleTypeService","7","_element","Element","getControllersByClass","instances","_instances","result","max","instance","push","beforeInstantiating","elements","afterInstantiating","root","className","exec","toString","toLocaleLowerCase","PARSE_ID_ATTRIBUTE","Math","floor","random","Date","now","8","Service","9","RoomleButton_1","HelperService_1","mobileDetect","helperService","HelperService","isIOS","Promise","scriptUrl","getRootUrl","promisePolyfillUrl","url","onload","onerror","async","src","./RoomleButton","./services/HelperService","10","Service_1","EnumEx_1","availableButtons","EnumEx","getValues","ADD","AR","CONFIGURE","MARK","VISUALIZE","VR","START_NOW","convertButtonType","../lib/Service","../utils/EnumEx","11","log","console","warn","12","IconsService_1","RequestService_1","Environment_1","ScriptLoaderService_1","buttonsService","iconsService","IconsService","requestService","RequestService","scriptLoaderService","ScriptLoaderService","elementCache","buttonsCache","shortLinkCache","waitingForShortLink","createCSS","css","string","property","buttonsCSS","containerClass","itemCSS","inlineCss","createTextNode","build","cacheKey","fragment","createDocumentFragment","li","buttonElement","buildTrigger","buttonTypeStr","icon","buildPopUpDom","closer","overlay","contentDiv","oldContent","buildAddToPlan","buildVisualize","buildConfigure","buildAR","buildMark","buildVR","buildButtons","div","containerType","ul_1","buttonsContainer","oneAdded_1","showOnlyTrigger","ar","conf","mark","vis","vr","trigger","insertBefore","firstChild","buildDeeplink","shortenId","typeStr","CONFIGURATION","CONFIGURABLE_ITEM","separator_1","deepLinkInterstitialUrl","resolve","encodeURIComponent","token","today","apiKey","tokenEncoded","toISOString","btoa","fetchJSON","config","method","headers","currentTenant","language","locale","referencedId","isAvailableLink","linkType","createDeeplinkInput","stopImmediatePropagation","createCopySvg","execCommand","copySvg","createCopy","h3","needsAppend","cachedLink","inputCached","createQRCode","spinner_1","then","shortLink","convertRoomleType","removeChild","textContent","translations","errors","deeplinkcreate","qrCodeElement","deepLinkContainer","reject","rootUrl","fetch","qrcode","QRCode","useSVG","makeCode","options","_a","_b","_c","_d","_e","heading","svgIcon","upperCase","charAt","toUpperCase","alternate_1","os","KNOWN_OSS","desktop","name","createDeeplinkFor","../config/Environment","../controllers/PopupController","./ButtonsService","./ConsoleService","./HelperService","./IconsService","./MobileDetectService","./MobileRedirectService","./RequestService","./RoomleTypeService","./ScriptLoaderService","./SettingsService","./TrackingService","13","triggerCallbacks","openPopUpCallbacks","event","findSelector","depth","maxDepth","matches","msMatchesSelector","parentElement","parentNode","triggerKey","callbackTrigger","callbackForType","getElement","hasAttribute","target","srcElement","roomleElement","typeElement","idElement","14","slice","lastIndexOf","15","getSvg","attributes","svg","createElementNS","SVG_NS","attribute","setAttributeNS","getNode","buildPlanIcon","isPlus","viewBox","firstPath","thirdPath","buildAdd","buildPlanNow","buildAr","secondPath","graph","fourthPath","path","buildCopy","path1","transform","path2","path3","path4","path5","buildVr","16","ios","android","Image","17","isOSCached","isAndroidCached","isIPadCached","isSupportedMobileCached","test","navigator","userAgent","MSStream","isDesktop","isAndroid","getOS","isSupportedMobile","isIPad","handlePlan","iosPlanLink","desktopLink","web","getIosLink","viewrLink","getAndroidLink","deeplinkUrl","encodeUrl","createLinkForItemOrConfiguration","isItem","iosIdentifier","webIdentifier","planId","iosLink","isConfigurableItem","configuratorUrl","handleItem","handleConfiguration","deeplink","PLAN","seperator","18","hasVisibilityListener","deeplinkInterstitialId","storePrefix","delay","oss","getTime","copyInputToClipboard","inputId","value","editable","contentEditable","readOnly","range","createRange","selectNodeContents","selection","getSelection","removeAllRanges","addRange","setSelectionRange","open","doCopy","isInIframe","self","iosE","visibilityHandler_1","interstitialIframe","removeEventListener","iframe","border","left","right","bottom","zIndex","scrollTo","handleAndroidBrowsers","appId","scheme","isAndroidMobile","regExAppleWebKit","RegExp","resultAppleWebKitRegEx","appleWebKitVersion","parseFloat","isAndroidBrowser","split","encodeURI","perfromDeepLink","osData","parsedLink","parseHref","data","finalURI","osin","hrefParts","el","display","19","xhr","XMLHttpRequest","TypeError","separator","uri","encodedKey","encodedContent","JSON","stringify","status","responseText","response","onabort","ontimeout","credentials","username","password","setRequestHeader","send","20","21","attachScript","_scriptCache","_idCache","undefined","integrity","22","setDefault","defaultValue","toCheck","keys","keysLength","setDeeplinkTranslation","translation","envSettings","userLanguage","browserLanguage","androidHint","iosHint","23","ID","isGAInitialized","gaProvider","tracking","enable","toLabel","interactionType","getUid","localStorage","session","getItem","parsedSession","authenticated","auth","userId","getGAProvider","ga","gaSetUid","uid","gaSetTenant","tenant","contentWindow","_sendToRoomle","command","commands","postMessage","concat","initGA","label","category","GA_CATEGROY","enabled","provider","eventCategory","eventAction","eventLabel","eventValue","hitType","24","getNamesAndValues","getNames","map","getObjValues","filter","v","k"],"mappings":"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","file":"roomle-button.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\"use strict\";\nvar controllers = require(\"./controllers/Controllers\");\nvar SettingsService_1 = require(\"./services/SettingsService\");\nvar EventHandlerService_1 = require(\"./services/EventHandlerService\");\nvar ButtonsService_1 = require(\"./services/ButtonsService\");\nvar DomBuilderService_1 = require(\"./services/DomBuilderService\");\nvar MobileRedirectService_1 = require(\"./services/MobileRedirectService\");\nvar MobileDetectService_1 = require(\"./services/MobileDetectService\");\nvar ConsoleService_1 = require(\"./services/ConsoleService\");\nvar RoomleTypeService_1 = require(\"./services/RoomleTypeService\");\nvar ImagesService_1 = require(\"./services/ImagesService\");\nvar TrackingService_1 = require(\"./services/TrackingService\");\nvar CONF_ID_PLACEHOLDER = '__CONFID__';\nvar RoomleButton = (function () {\n    function RoomleButton(settings) {\n        this.domBuilder = null;\n        this.trackingService = null;\n        this.imagesService = null;\n        this.eventHandler = null;\n        this.mobileRedirectService = null;\n        this.mobileDetectService = null;\n        SettingsService_1.SettingsService.init(settings);\n        this.domBuilder = DomBuilderService_1.DomBuilderService.inject();\n        this.trackingService = TrackingService_1.TrackingService.inject();\n        this.imagesService = ImagesService_1.ImagesService.inject();\n        this.eventHandler = EventHandlerService_1.EventHandlerService.inject();\n        this.mobileRedirectService = MobileRedirectService_1.MobileRedirectService.inject();\n        this.mobileDetectService = MobileDetectService_1.MobileDetectService.inject();\n        this.trackingService.trackGA('Init');\n        this.imagesService.preloadImages();\n        this._addCSS();\n        this._boot();\n    }\n    ;\n    RoomleButton.prototype._addCSS = function () {\n        var head = document.head || document.getElementsByTagName('head')[0];\n        var styleHref = SettingsService_1.SettingsService.settings.cssPath;\n        if (!SettingsService_1.SettingsService.settings.cssPath) {\n            var scriptId = 'rml-button-lib';\n            var script = document.getElementById(scriptId);\n            if (!script) {\n                return;\n            }\n            var href = script.getAttribute('src');\n            styleHref = href.replace(/\\.js/g, '.css');\n            if (styleHref && styleHref.length > 1 && styleHref[0] === 'j' && styleHref[1] === 's') {\n                styleHref = styleHref.substr(2);\n                styleHref = 'css' + styleHref;\n            }\n            else {\n                styleHref = styleHref.replace(/\\/js\\//g, '/css/');\n            }\n        }\n        var style = document.createElement('link');\n        //style.async = true;\n        style.href = styleHref;\n        style.rel = 'stylesheet';\n        style.media = 'all';\n        if (!SettingsService_1.SettingsService.settings.cssSkipIntegrity) {\n            style.setAttribute('integrity', '###sricheck###');\n        }\n        head.appendChild(style);\n    };\n    RoomleButton.prototype._setupClickListener = function (container) {\n        var _this = this;\n        container.addEventListener('click', function (e) {\n            _this.eventHandler.handle(e);\n        });\n    };\n    RoomleButton.prototype._boot = function () {\n        var controllerClasses = controllers;\n        var element = document.body;\n        this.domBuilder.addCSS();\n        if (SettingsService_1.SettingsService.settings.container) {\n            var elementList = document.body.querySelectorAll(SettingsService_1.SettingsService.settings.container);\n            if (elementList.length) {\n                element = elementList[0];\n            }\n        }\n        if (SettingsService_1.SettingsService.settings.createPopUp) {\n            this.domBuilder.buildPopUp(element);\n        }\n        this._setupClickListener(element);\n        var instanceSelector = SettingsService_1.SettingsService.settings.selector; // ? this.settings.selector : '[data-roomle-id]';\n        for (var key in controllerClasses) {\n            if (controllerClasses.hasOwnProperty(key)) {\n                if (key === 'RoomleController' && SettingsService_1.SettingsService.settings.mode === 'lib') {\n                    continue;\n                }\n                var controllerClass = controllerClasses[key];\n                if (typeof controllerClass.parse === 'function') {\n                    controllerClass.parse(instanceSelector, element);\n                }\n            }\n        }\n    };\n    RoomleButton.prototype.openCustomPopUp = function (e, content, parent) {\n        var _this = this;\n        this.domBuilder.buildCustomPopUp(content, parent);\n        this.trackingService.trackGA('OpenCustomPopUp');\n        setTimeout(function () {\n            _this.eventHandler.dispatchOpenPopUp(e);\n        }, 1);\n    };\n    RoomleButton.prototype.dispatchClick = function (e, id, type, buttonType, highlight) {\n        if (highlight === void 0) { highlight = null; }\n        this.trackingService.trackGAInteraction('DispatchClick:', id, buttonType);\n        this.eventHandler.dispatch(e, type, id, ButtonsService_1.ButtonsService.convertButtonTypeToEnum(buttonType), highlight);\n    };\n    RoomleButton.prototype.getDomLinkFor = function (action, id, type, isHighlighted, callbackUrl) {\n        if (isHighlighted === void 0) { isHighlighted = false; }\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        var roomleType = RoomleTypeService_1.RoomleTypeService.convertTypeToEnum(type);\n        var buttonType = ButtonsService_1.ButtonsService.convertButtonTypeToEnum(action);\n        var link = this.mobileDetectService.generateLink(id, roomleType, buttonType);\n        var buildOptions = { isHighlighted: isHighlighted, buildAnyway: true, callbackUrl: callbackUrl };\n        this.trackingService.trackGAInteraction('GetDomLinkFor:', id, action);\n        return this.domBuilder.buildLink(link, buildOptions);\n    };\n    RoomleButton.prototype.appendButtons = function (container, id, type) {\n        var _this = this;\n        this.trackingService.trackGA('AppendButtons');\n        var links = this.getLinks(id, type);\n        links.forEach(function (link) {\n            container.appendChild(_this.domBuilder.buildLink(link));\n        });\n    };\n    RoomleButton.prototype.execDeeplink = function (id, type, clickedButton, newWindow, callback, callbackUrl, wasDeviceSwitch) {\n        if (newWindow === void 0) { newWindow = true; }\n        if (callback === void 0) { callback = null; }\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        if (wasDeviceSwitch === void 0) { wasDeviceSwitch = false; }\n        var roomleType = RoomleTypeService_1.RoomleTypeService.convertTypeToEnum(type);\n        var buttonType = ButtonsService_1.ButtonsService.convertButtonTypeToEnum(clickedButton);\n        if (roomleType === RoomleTypeService_1.ROOMLE_TYPE.ITEM && callbackUrl && typeof callbackUrl === 'string' && callbackUrl.indexOf(CONF_ID_PLACEHOLDER) !== -1) {\n            ConsoleService_1.ConsoleService.error('Can not use ' + CONF_ID_PLACEHOLDER + ' with an item which is not configure able');\n            return;\n        }\n        var link = this.mobileDetectService.generateLink(id, roomleType, buttonType, callbackUrl);\n        this.trackingService.trackGAInteraction('ExecDeeplink:', id, clickedButton);\n        if (link.alternate) {\n            this.trackingService.trackGAInteraction('ExecDeeplink:Alternate:', id, clickedButton);\n            var event_1 = document.createEvent('Event');\n            event_1.initEvent('execDeeplink', true, true);\n            this.eventHandler.dispatch(event_1, type, id, ButtonsService_1.BUTTON_TYPE.TRIGGER, clickedButton, newWindow, callbackUrl);\n        }\n        else {\n            this.trackingService.trackGAInteraction('ExecDeeplink:Regular:', id, clickedButton);\n            this.mobileRedirectService.redirect(link, newWindow, callback, callbackUrl, wasDeviceSwitch);\n        }\n    };\n    RoomleButton.prototype.redirectTo = function (link, newWindow, callback, useTimeout) {\n        if (newWindow === void 0) { newWindow = false; }\n        if (callback === void 0) { callback = null; }\n        if (useTimeout === void 0) { useTimeout = false; }\n        this.mobileRedirectService.redirectTo(link, newWindow, callback, useTimeout);\n    };\n    RoomleButton.prototype.redirectToStore = function (link, newWindow, callback, useTimeout) {\n        if (newWindow === void 0) { newWindow = false; }\n        if (callback === void 0) { callback = null; }\n        if (useTimeout === void 0) { useTimeout = false; }\n        this.mobileRedirectService.redirectToStore(link, newWindow, callback);\n    };\n    RoomleButton.prototype.getLinks = function (id, type, callbackUrl) {\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        this.trackingService.trackGAInteraction('GetLinks:', id);\n        return this.mobileDetectService.getLinks(id, RoomleTypeService_1.RoomleTypeService.convertTypeToEnum(type), callbackUrl);\n    };\n    RoomleButton.getInstance = function (settings) {\n        var _this = this;\n        if (!(this._instance instanceof RoomleButton)) {\n            this._instance = new this(settings);\n        }\n        if (!window.RoomleButtonInstance) {\n            var rmlObject = Object.getPrototypeOf(this._instance);\n            var exposedObject = {};\n            var _loop_1 = function (key) {\n                if (key && rmlObject.hasOwnProperty(key) && key[0] !== '_') {\n                    exposedObject[key] = function () {\n                        var args = [];\n                        for (var _i = 0; _i < arguments.length; _i++) {\n                            args[_i] = arguments[_i];\n                        }\n                        return _this._instance[key].apply(_this._instance, args);\n                    };\n                }\n            };\n            for (var key in rmlObject) {\n                _loop_1(key);\n            }\n            window.RoomleButtonInstance = exposedObject;\n            SettingsService_1.SettingsService.settings.callback.booted();\n        }\n        return this._instance;\n    };\n    return RoomleButton;\n}());\nexports.RoomleButton = RoomleButton;\n\n},{\"./controllers/Controllers\":4,\"./services/ButtonsService\":10,\"./services/ConsoleService\":11,\"./services/DomBuilderService\":12,\"./services/EventHandlerService\":13,\"./services/ImagesService\":16,\"./services/MobileDetectService\":17,\"./services/MobileRedirectService\":18,\"./services/RoomleTypeService\":20,\"./services/SettingsService\":22,\"./services/TrackingService\":23}],2:[function(require,module,exports){\n\"use strict\";\nvar Environments_1 = require(\"./Environments\");\nvar LIVE_BASE_URL = 'www.roomle.com/';\nvar Environment = (function () {\n    function Environment() {\n    }\n    Environment.settings = function () {\n        var gaPath = 'public/libraries/roomle-ga/ga.html';\n        var settings = {\n            rapi: 'api.test.roomle.com/v2',\n            protocol: 'https://',\n            rmlco: '',\n            shortlink: function (type, id, button, shortId) {\n                if (shortId === void 0) { shortId = null; }\n                if (this.baseUrl === LIVE_BASE_URL) {\n                    return 'http://rml.co/' + shortId + '/' + button;\n                }\n                return this.baseServer + 'deeplink?id=' + id + '&type=' + type + '&button=' + button;\n            },\n            gaUrl: '',\n            baseUrl: LIVE_BASE_URL,\n            baseServer: ''\n        };\n        if (Environment.env !== Environments_1.Environments.TEST) {\n            settings.rapi = 'api.roomle.com/v2';\n        }\n        var alphaBaseUrl = 'alpha.roomle.com/';\n        var productionBaseUrl = 'www.roomle.com/';\n        var testBaseUrl = 'test.roomle.com/';\n        var settingsOverride = (window.RoomleButtonSettings) ? window.RoomleButtonSettings : {};\n        if (window.location.href.indexOf('alpha.roomle.com') !== -1) {\n            settings.baseUrl = alphaBaseUrl;\n        }\n        else if (window.location.href.indexOf('test.roomle.com') !== -1) {\n            settings.baseUrl = testBaseUrl;\n        }\n        else if (window.location.href.indexOf('www.roomle.com') !== -1) {\n            settings.baseUrl = productionBaseUrl;\n        }\n        settings.rmlco = settings.protocol + settings.rapi + '/shortIds';\n        if (settingsOverride.protocol) {\n            settings.protocol = settingsOverride.protocol;\n        }\n        if (settingsOverride.baseUrl) {\n            settings.baseUrl = settingsOverride.baseUrl;\n        }\n        settings.baseServer = settings.protocol + settings.baseUrl;\n        settings.gaUrl = settings.baseServer + gaPath;\n        if (settingsOverride.gaUrl) {\n            settings.gaUrl = settingsOverride.gaUrl;\n        }\n        return settings;\n    };\n    Object.defineProperty(Environment, \"env\", {\n        get: function () {\n            return this.envIndicator.substring(3, this.envIndicator.length - 3);\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Environment, \"config\", {\n        get: function () {\n            return Environment.settings();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return Environment;\n}());\nEnvironment.envIndicator = '###production###';\nexports.Environment = Environment;\n\n},{\"./Environments\":3}],3:[function(require,module,exports){\n\"use strict\";\nvar Environments = (function () {\n    function Environments() {\n    }\n    return Environments;\n}());\nEnvironments.PRODUCTION = 'production';\nEnvironments.TEST = 'test';\nEnvironments.ALPHA = 'alpha';\nexports.Environments = Environments;\n\n},{}],4:[function(require,module,exports){\n\"use strict\";\nvar RoomleController_1 = require(\"./RoomleController\");\nexports.RoomleController = RoomleController_1.RoomleController;\nvar PopupController_1 = require(\"./PopupController\");\nexports.PopupController = PopupController_1.PopupController;\n\n},{\"./PopupController\":5,\"./RoomleController\":6}],5:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Controller_1 = require(\"../lib/Controller\");\nvar SettingsService_1 = require(\"../services/SettingsService\");\nvar EventHandlerService_1 = require(\"../services/EventHandlerService\");\nvar DomBuilderService_1 = require(\"../services/DomBuilderService\");\nvar ImagesService_1 = require(\"../services/ImagesService\");\nvar TrackingService_1 = require(\"../services/TrackingService\");\nvar PopupController = (function (_super) {\n    __extends(PopupController, _super);\n    function PopupController(element) {\n        var _this = _super.call(this, element) || this;\n        _this.eventHandlerService = EventHandlerService_1.EventHandlerService.inject();\n        _this.domBuilderService = DomBuilderService_1.DomBuilderService.inject();\n        _this.imagesService = ImagesService_1.ImagesService.inject();\n        _this.trackingService = TrackingService_1.TrackingService.inject();\n        if (!SettingsService_1.SettingsService.settings.createPopUp) {\n            return _this;\n        }\n        _this.eventHandlerService.subscribe(EventHandlerService_1.EVENT_TYPES.TRIGGER, _this.openPopup.bind(_this));\n        _this.eventHandlerService.subscribe(EventHandlerService_1.EVENT_TYPES.POP_UP_OPEN, _this.simpleOpen.bind(_this));\n        _this.eventHandlerService.subscribe(EventHandlerService_1.EVENT_TYPES.POP_UP_CLOSE, _this.closePopup.bind(_this));\n        document.querySelectorAll('.rml-md-overlay')[0].addEventListener('click', function () { return _this.closePopup(); });\n        _this.$('.rml-popup--close')[0].addEventListener('click', function () { return _this.closePopup(); });\n        if (SettingsService_1.SettingsService.settings.showBackButton) {\n            _this.$('.rml-popup--back')[0].addEventListener('click', function () { return _this.back(); });\n        }\n        else {\n            _this.$('.rml-popup--back')[0].classList.add('rml-popup--back__hide');\n        }\n        return _this;\n        //this.roomleButtonService.addRoomleButton(this.triggerClicked.bind(this));\n    }\n    PopupController.prototype.adjustWrapperCss = function () {\n        var wrapper = document.querySelectorAll('.rml-btn-wrapper');\n        if (wrapper[0].classList.contains('rml-popup__opened')) {\n            wrapper[0].classList.remove('rml-popup__opened');\n            wrapper[0].classList.add('rml-popup__closed');\n        }\n        else {\n            wrapper[0].classList.add('rml-popup__opened');\n            wrapper[0].classList.remove('rml-popup__closed');\n        }\n    };\n    PopupController.prototype.closePopup = function () {\n        var classList = this.$('.rml-popup')[0].classList;\n        this.trackingService.trackGAInteraction('ClosePopUp:', this.id);\n        this.adjustWrapperCss();\n        if (classList.contains('rml-md-show')) {\n            classList.remove('rml-md-show');\n            var back = this.$('.rml-popup--back')[0];\n            back.classList.remove('rml-popup--back__show');\n            this.unfreezeScrolling();\n            var popUp = document.querySelectorAll('[' + SettingsService_1.SettingsService.settings.popUpSelector + ']');\n            popUp[0].removeAttribute('data-rml-popup-item-id');\n            if (typeof SettingsService_1.SettingsService.settings.callback.popupClose === 'function') {\n                var id = (this.id) ? this.id : 'CUSTOM';\n                var type = (this.type) ? this.type : 'CUSTOM';\n                SettingsService_1.SettingsService.settings.callback.popupClose(id, type);\n            }\n        }\n        else {\n            classList.add('rml-md-show');\n            this.freezeScrolling();\n        }\n    };\n    PopupController.prototype.back = function () {\n        var linksContainer = this.$('.rml-deeplink--slider')[0];\n        linksContainer.classList.remove('rml-deeplink__hint');\n        var hintContainer = this.$('.rml-deeplink__hint-container')[0];\n        hintContainer.innerHTML = '';\n        var back = this.$('.rml-popup--back')[0];\n        back.classList.remove('rml-popup--back__show');\n        var hintText = this.$('.rml-deeplink--hint');\n        if (hintText.length) {\n            var text = hintText[0];\n            text.classList.remove('rml-hint__show');\n        }\n    };\n    PopupController.prototype.simpleOpen = function (e, id, type) {\n        e.preventDefault();\n        this.id = id;\n        this.type = type;\n        var popUp = document.querySelectorAll('[' + SettingsService_1.SettingsService.settings.popUpSelector + ']');\n        popUp[0].setAttribute('data-rml-popup-item-id', this.id);\n        var modal = popUp[0].querySelectorAll('.rml-md-modal');\n        var wrapper = document.querySelectorAll('.rml-btn-wrapper')[0];\n        wrapper.scrollTop = 0;\n        this.adjustWrapperCss();\n        if (modal[0].classList.contains('rml-md-show')) {\n            modal[0].classList.remove('rml-md-show');\n        }\n        else {\n            modal[0].classList.add('rml-md-show');\n        }\n        this.freezeScrolling();\n        if (typeof SettingsService_1.SettingsService.settings.callback.popupOpen === 'function') {\n            SettingsService_1.SettingsService.settings.callback.popupOpen((id) ? id : 'CUSTOM', (type) ? type : 'CUSTOM');\n        }\n        return modal[0];\n    };\n    PopupController.prototype.openPopup = function (e, id, type, links, highlight, newWindow, callbackUrl) {\n        var _this = this;\n        if (newWindow === void 0) { newWindow = false; }\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        this.trackingService.trackGAInteraction('OpenPopUp:', id);\n        var modal = this.simpleOpen(e, id, type);\n        var container = modal.querySelectorAll('.rml-generated-content');\n        container[0].innerHTML = '';\n        var linksContainer = document.createElement('div');\n        linksContainer.classList.add('rml-deeplink--slider');\n        linksContainer.classList.add('rml-deeplink--links');\n        var slide = document.createElement('div');\n        slide.classList.add('rml-deeplink--slide');\n        slide.classList.add('rml-deeplink--overview');\n        var alternate = document.createElement('div');\n        alternate.classList.add('rml-deeplink--slide');\n        alternate.classList.add('rml-deeplink--alternate');\n        links.forEach(function (link) {\n            var isHighlighted = link.type === highlight;\n            var linkDom = _this.domBuilderService.buildLink(link, {\n                isHighlighted: isHighlighted,\n                slideMode: true,\n                callbackUrl: callbackUrl,\n                clickedHint: function () {\n                    alternate.innerHTML = '';\n                    var hintContainer = document.createElement('div');\n                    hintContainer.classList.add('rml-deeplink__hint-container');\n                    var imgContainer = document.createElement('div');\n                    var dom = document.createElement('div');\n                    imgContainer.classList.add('rml-deeplink__hint-img');\n                    dom.classList.add('rml-deeplink__hint-link');\n                    var img = document.createElement('img');\n                    var imgUrl = _this.imagesService.images[link.alternate];\n                    img.setAttribute('src', imgUrl);\n                    imgContainer.appendChild(img);\n                    hintContainer.appendChild(imgContainer);\n                    var back = document.querySelector('.rml-popup--back');\n                    if (SettingsService_1.SettingsService.settings.showBackButton) {\n                        back.classList.add('rml-popup--back__show');\n                    }\n                    var domLink = linkDom.cloneNode(true);\n                    dom.appendChild(domLink);\n                    _this.trackingService.trackGAInteraction('ClickedHint:', link.id, link.type);\n                    alternate.appendChild(hintContainer);\n                    if (linksContainer.classList.contains('rml-deeplink__hint')) {\n                        linksContainer.classList.remove('rml-deeplink__hint');\n                    }\n                    else {\n                        linksContainer.classList.add('rml-deeplink__hint');\n                    }\n                    var hint = dom.querySelector('.rml-deeplink--hint');\n                    hintContainer.appendChild(dom);\n                    _this.domBuilderService.addShortlink(dom, link.roomleType, link.type, link.id, callbackUrl);\n                    hint.classList.add('rml-hint__show');\n                    var newlinkDom = alternate.querySelector('.rml-deeplink--row');\n                    newlinkDom.addEventListener('click', function (e) {\n                        e.preventDefault();\n                        var input = dom.querySelector('input');\n                        input.select();\n                        _this.trackingService.trackGAInteraction('ClickedIntoShortUrl:', _this.id, link.type);\n                        return false;\n                    });\n                    if (typeof SettingsService_1.SettingsService.settings.callback.clickedHint === 'function') {\n                        SettingsService_1.SettingsService.settings.callback.clickedHint(link.id, link.roomleType, link.type);\n                    }\n                }\n            });\n            if (!linkDom) {\n                return;\n            }\n            slide.appendChild(linkDom);\n        });\n        linksContainer.appendChild(slide);\n        linksContainer.appendChild(alternate);\n        container[0].appendChild(linksContainer);\n    };\n    PopupController.prototype.freezeScrolling = function () {\n        var html = document.querySelector('html');\n        var body = document.body;\n        if (html.style.position !== 'fixed') {\n            var top_1 = html.scrollTop ? html.scrollTop : body.scrollTop;\n            if (window.innerWidth > html.offsetWidth) {\n                html.style.overflowY = 'scroll';\n            }\n            html.style.width = '100%';\n            html.style.height = '100%';\n            html.style.position = 'fixed';\n            html.style.top = (-top_1) + 'px';\n        }\n    };\n    PopupController.prototype.unfreezeScrolling = function () {\n        var html = document.querySelector('html');\n        var body = document.body;\n        if (html.style.position === 'fixed') {\n            html.style.position = 'static';\n            var scrollTopValue = -parseInt(html.style.top, 10);\n            html.scrollTop = scrollTopValue;\n            body.scrollTop = scrollTopValue;\n            html.style.position = '';\n            html.style.width = '';\n            html.style.height = '';\n            html.style.top = '';\n            html.style.overflowY = '';\n        }\n    };\n    return PopupController;\n}(Controller_1.Controller));\nPopupController.selector = '[data-rml-deeplink-popup-container]';\nexports.PopupController = PopupController;\n\n},{\"../lib/Controller\":7,\"../services/DomBuilderService\":12,\"../services/EventHandlerService\":13,\"../services/ImagesService\":16,\"../services/SettingsService\":22,\"../services/TrackingService\":23}],6:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Controller_1 = require(\"../lib/Controller\");\nvar DomBuilderService_1 = require(\"../services/DomBuilderService\");\nvar RoomleTypeService_1 = require(\"../services/RoomleTypeService\");\nvar SettingsService_1 = require(\"../services/SettingsService\");\nvar RoomleController = (function (_super) {\n    __extends(RoomleController, _super);\n    function RoomleController(element) {\n        var _this = _super.call(this, element) || this;\n        _this.id = null;\n        _this.type = null;\n        _this.domBuilder = DomBuilderService_1.DomBuilderService.inject();\n        if (element) {\n            var idSelector = SettingsService_1.SettingsService.settings.dataSelector.id;\n            var typeSelector = SettingsService_1.SettingsService.settings.dataSelector.type;\n            _this.id = element.getAttribute(idSelector);\n            _this.type = RoomleTypeService_1.RoomleTypeService.convertTypeToEnum(element.getAttribute(typeSelector));\n            if (_this.type !== null && _this.id) {\n                _this.addButtons(_this.type);\n            }\n        }\n        return _this;\n    }\n    RoomleController.prototype.addButtons = function (type) {\n        if (SettingsService_1.SettingsService.settings.createNoButtons) {\n            return;\n        }\n        var item = this.$();\n        if (!item) {\n            return;\n        }\n        var buttons = this.domBuilder.getButtons(type);\n        item.appendChild(buttons);\n    };\n    return RoomleController;\n}(Controller_1.Controller));\nexports.RoomleController = RoomleController;\n\n},{\"../lib/Controller\":7,\"../services/DomBuilderService\":12,\"../services/RoomleTypeService\":20,\"../services/SettingsService\":22}],7:[function(require,module,exports){\n\"use strict\";\n/**\n * Generic controller class to entcapsulate the parsing\n * and other generic stuff\n *\n * @export\n * @class Controller\n */\nvar Controller = (function () {\n    /**\n     * Creates an instance of a Controller.\n     *\n     * @param {Element} root The element where the controller has been applied\n     */\n    function Controller(element) {\n        this._element = element;\n    }\n    Controller.prototype.$ = function (selector) {\n        if (!(this._element instanceof Element)) {\n            throw new Error('This controller has no element!');\n        }\n        return selector ? this._element.querySelectorAll(selector) : this._element;\n    };\n    Controller.prototype.getControllersByClass = function (controllerClass) {\n        var instances = Controller._instances;\n        var result = [];\n        for (var i = 0, max = instances.length; i < max; i++) {\n            var instance = instances[i];\n            if (instance instanceof controllerClass) {\n                result.push(instance);\n            }\n        }\n        return result;\n    };\n    /**\n     * Hook for running code before the controller is instantiated\n     *\n     * @static\n     * @param {NodeListOf<Element>} elements List of elements where the controller will be applied\n     */\n    Controller.beforeInstantiating = function (elements) {\n    };\n    /**\n     * Hook for running code after the controller has been instantiated.\n     *\n     * @static\n     * @param {NodeListOf<Element>} elements List of elements where the controller has been applied\n     * @param {Array<Controller>} instances List of controller instances created\n     */\n    Controller.afterInstantiating = function (elements, instances) {\n    };\n    /**\n     * Look for elements with a specific selector and creates an instance for\n     * every element.\n     *\n     * @static\n     * @param {string} selector Dom selector\n     * @param {Element} [root=document.body] Starting element for parsing\n     */\n    Controller.parse = function (selector, root) {\n        if (root === void 0) { root = document.body; }\n        if (typeof this.selector === 'string' && this.selector.length) {\n            selector = this.selector;\n        }\n        else if (!selector) {\n            return;\n        }\n        var elements = root.querySelectorAll(selector);\n        this.beforeInstantiating(elements);\n        for (var i = 0; i < elements.length; i++) {\n            var element = elements[i];\n            var className = /^function\\s+([\\w\\$]+)\\s*\\(/.exec(this.toString())[1];\n            className = className.toLocaleLowerCase();\n            if (element.getAttribute(Controller.PARSE_ID_ATTRIBUTE + '-' + className)) {\n                continue;\n            }\n            element.setAttribute(Controller.PARSE_ID_ATTRIBUTE + '-' + className, Math.floor(Math.random() * 10 + 1) * Date.now() + '');\n            Controller._instances.push(new this(element));\n        }\n        this.afterInstantiating(elements, Controller._instances);\n    };\n    return Controller;\n}());\n/**\n * Instances of the Controller\n *\n * @static\n * @type {Array<Controller>}\n */\nController._instances = [];\n/**\n * HTML attribute to mark elements which are already parsed\n *\n * @static\n */\nController.PARSE_ID_ATTRIBUTE = 'data-parse-id';\nexports.Controller = Controller;\n\n},{}],8:[function(require,module,exports){\n\"use strict\";\n/**\n * Simple Singelton Service implementation\n * which will be extended by the other Services like\n * - DataSerivce\n * - TemplateService\n * - ...\n *\n * @export\n * @class Service\n */\nvar Service = (function () {\n    function Service() {\n    }\n    /**\n     * Returns the current instance or creates a new\n     * one if there isn't already an instance available.\n     *\n     * @static\n     * @returns {Service} Instance of the current Service\n     */\n    Service.getInstance = function () {\n        if (!(this._instance instanceof Service)) {\n            this._instance = new this();\n        }\n        return this._instance;\n    };\n    /**\n     * Naming Wrapper for the getInstance() function\n     * because inject sounds cooler.\n     *\n     * @static\n     * @returns {Service} Instance of the current Service\n     */\n    Service.inject = function () {\n        return this.getInstance();\n    };\n    return Service;\n}());\nexports.Service = Service;\n\n},{}],9:[function(require,module,exports){\n\"use strict\";\nvar MobileDetectService_1 = require(\"./services/MobileDetectService\");\nvar RoomleButton_1 = require(\"./RoomleButton\");\nvar ConsoleService_1 = require(\"./services/ConsoleService\");\nvar HelperService_1 = require(\"./services/HelperService\");\n(function () {\n    var mobileDetect = MobileDetectService_1.MobileDetectService.inject();\n    var helperService = HelperService_1.HelperService.inject();\n    mobileDetect.isIOS();\n    var settings = (window.RoomleButtonSettings) ? window.RoomleButtonSettings : {};\n    if (!window.Promise) {\n        var scriptUrl = helperService.getRootUrl;\n        var promisePolyfillUrl = window.RoomleButtonSettings.promisePolyfillUrl;\n        if (!scriptUrl && !promisePolyfillUrl) {\n            ConsoleService_1.ConsoleService.error('This browser needs a promise polyfill! Include it yourself or use the lazy loading from the roomle button lib');\n            RoomleButton_1.RoomleButton.getInstance(settings);\n            return;\n        }\n        var url = '';\n        if (!promisePolyfillUrl) {\n            url = scriptUrl + '/es6-promise.min.js';\n        }\n        else {\n            url = promisePolyfillUrl;\n        }\n        var element = document.createElement('script');\n        element.onload = function () { return RoomleButton_1.RoomleButton.getInstance(settings); };\n        element.onerror = function (error) { return RoomleButton_1.RoomleButton.getInstance(settings); };\n        element.async = true;\n        element.src = url;\n        element.setAttribute('type', 'text/javascript');\n        document.body.appendChild(element);\n    }\n    else {\n        RoomleButton_1.RoomleButton.getInstance(settings);\n    }\n}());\n\n},{\"./RoomleButton\":1,\"./services/ConsoleService\":11,\"./services/HelperService\":14,\"./services/MobileDetectService\":17}],10:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar EnumEx_1 = require(\"../utils/EnumEx\");\nvar BUTTON_TYPE;\n(function (BUTTON_TYPE) {\n    BUTTON_TYPE[BUTTON_TYPE[\"TRIGGER\"] = 0] = \"TRIGGER\";\n    BUTTON_TYPE[BUTTON_TYPE[\"ADD\"] = 1] = \"ADD\";\n    BUTTON_TYPE[BUTTON_TYPE[\"VISUALIZE\"] = 2] = \"VISUALIZE\";\n    BUTTON_TYPE[BUTTON_TYPE[\"CONFIGURE\"] = 3] = \"CONFIGURE\";\n    BUTTON_TYPE[BUTTON_TYPE[\"AR\"] = 4] = \"AR\";\n    BUTTON_TYPE[BUTTON_TYPE[\"MARK\"] = 5] = \"MARK\";\n    BUTTON_TYPE[BUTTON_TYPE[\"START_NOW\"] = 6] = \"START_NOW\";\n    BUTTON_TYPE[BUTTON_TYPE[\"VR\"] = 7] = \"VR\";\n})(BUTTON_TYPE = exports.BUTTON_TYPE || (exports.BUTTON_TYPE = {}));\nvar ButtonsService = (function (_super) {\n    __extends(ButtonsService, _super);\n    function ButtonsService() {\n        var _this = _super.call(this) || this;\n        _this.availableButtons = EnumEx_1.EnumEx.getValues(BUTTON_TYPE);\n        return _this;\n    }\n    ButtonsService.convertButtonTypeToEnum = function (buttonType) {\n        if (buttonType === 'trigger') {\n            return BUTTON_TYPE.TRIGGER;\n        }\n        if (buttonType === 'add') {\n            return BUTTON_TYPE.ADD;\n        }\n        if (buttonType === 'ar') {\n            return BUTTON_TYPE.AR;\n        }\n        if (buttonType === 'configure') {\n            return BUTTON_TYPE.CONFIGURE;\n        }\n        if (buttonType === 'mark') {\n            return BUTTON_TYPE.MARK;\n        }\n        if (buttonType === 'visualize') {\n            return BUTTON_TYPE.VISUALIZE;\n        }\n        if (buttonType === 'vr') {\n            return BUTTON_TYPE.VR;\n        }\n        if (buttonType === 'start_now') {\n            return BUTTON_TYPE.START_NOW;\n        }\n        return null;\n    };\n    // USED TO DEFINE HOOKS FOR OUTSIDE TS WORLD. AR IS NICER THAN \"0\"\n    ButtonsService.convertButtonType = function (buttonType) {\n        if (buttonType === BUTTON_TYPE.TRIGGER) {\n            return 'trigger';\n        }\n        if (buttonType === BUTTON_TYPE.ADD) {\n            return 'add';\n        }\n        if (buttonType === BUTTON_TYPE.AR) {\n            return 'ar';\n        }\n        if (buttonType === BUTTON_TYPE.CONFIGURE) {\n            return 'configure';\n        }\n        if (buttonType === BUTTON_TYPE.MARK) {\n            return 'mark';\n        }\n        if (buttonType === BUTTON_TYPE.VISUALIZE) {\n            return 'visualize';\n        }\n        if (buttonType === BUTTON_TYPE.VR) {\n            return 'vr';\n        }\n        if (buttonType === BUTTON_TYPE.START_NOW) {\n            return 'start_now';\n        }\n        return null;\n    };\n    return ButtonsService;\n}(Service_1.Service));\nexports.ButtonsService = ButtonsService;\n\n},{\"../lib/Service\":8,\"../utils/EnumEx\":24}],11:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar ConsoleService = (function (_super) {\n    __extends(ConsoleService, _super);\n    function ConsoleService() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ConsoleService.log = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        console.log.apply(console, args);\n    };\n    ConsoleService.warn = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        console.warn.apply(console, args);\n    };\n    ConsoleService.error = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        console.error.apply(console, args);\n    };\n    return ConsoleService;\n}(Service_1.Service));\nexports.ConsoleService = ConsoleService;\n\n},{\"../lib/Service\":8}],12:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar MobileDetectService_1 = require(\"./MobileDetectService\");\nvar SettingsService_1 = require(\"./SettingsService\");\nvar HelperService_1 = require(\"./HelperService\");\nvar ButtonsService_1 = require(\"./ButtonsService\");\nvar RoomleTypeService_1 = require(\"./RoomleTypeService\");\nvar IconsService_1 = require(\"./IconsService\");\nvar ConsoleService_1 = require(\"./ConsoleService\");\nvar MobileRedirectService_1 = require(\"./MobileRedirectService\");\nvar PopupController_1 = require(\"../controllers/PopupController\");\nvar RequestService_1 = require(\"./RequestService\");\nvar Environment_1 = require(\"../config/Environment\");\nvar TrackingService_1 = require(\"./TrackingService\");\nvar ScriptLoaderService_1 = require(\"./ScriptLoaderService\");\nvar DomBuilderService = (function (_super) {\n    __extends(DomBuilderService, _super);\n    function DomBuilderService() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.trackingService = TrackingService_1.TrackingService.inject();\n        _this.helperService = HelperService_1.HelperService.inject();\n        _this.mobileDetect = MobileDetectService_1.MobileDetectService.inject();\n        _this.buttonsService = ButtonsService_1.ButtonsService.inject();\n        _this.iconsService = IconsService_1.IconsService.inject();\n        _this.mobileRedirectService = MobileRedirectService_1.MobileRedirectService.inject();\n        _this.requestService = RequestService_1.RequestService.inject();\n        _this.scriptLoaderService = ScriptLoaderService_1.ScriptLoaderService.inject();\n        _this.elementCache = {};\n        _this.buttonsCache = {};\n        _this.shortLinkCache = {};\n        _this.waitingForShortLink = false;\n        return _this;\n    }\n    DomBuilderService.prototype.createCSS = function (css) {\n        var string = '';\n        for (var property in css) {\n            if (css.hasOwnProperty(property)) {\n                string += property + ':' + css[property] + ';';\n            }\n        }\n        return string;\n    };\n    DomBuilderService.prototype.addCSS = function () {\n        if (SettingsService_1.SettingsService.settings.createNoButtons) {\n            return;\n        }\n        var buttonsCSS = this.createCSS(SettingsService_1.SettingsService.settings.css.buttons);\n        buttonsCSS = '.' + SettingsService_1.SettingsService.settings.html.containerClass + '{' + buttonsCSS + 'visibility: hidden;}';\n        var itemCSS = this.createCSS(SettingsService_1.SettingsService.settings.css.item);\n        itemCSS = SettingsService_1.SettingsService.settings.selector + '{' + itemCSS + '}';\n        var inlineCss = '.rml-md-modal{visibility:hidden;}';\n        var css = buttonsCSS + itemCSS + inlineCss;\n        var head = document.head || document.getElementsByTagName('head')[0];\n        var style = document.createElement('style');\n        style.type = 'text/css';\n        style.appendChild(document.createTextNode(css));\n        head.appendChild(style);\n    };\n    DomBuilderService.prototype.build = function (cacheKey, content) {\n        if (!this.elementCache[cacheKey]) {\n            var fragment = document.createDocumentFragment();\n            var li = document.createElement(SettingsService_1.SettingsService.settings.html.buttonElement);\n            var buttonType = ButtonsService_1.ButtonsService.convertButtonType(cacheKey);\n            li.setAttribute(SettingsService_1.SettingsService.settings.dataSelector.action, buttonType);\n            fragment.appendChild(li);\n            this.elementCache[cacheKey] = fragment;\n        }\n        return this.elementCache[cacheKey].cloneNode(true);\n    };\n    DomBuilderService.prototype.buildTrigger = function () {\n        var cacheKey = ButtonsService_1.BUTTON_TYPE.TRIGGER;\n        var buttonTypeStr = ButtonsService_1.ButtonsService.convertButtonType(cacheKey);\n        if (!this.elementCache[cacheKey]) {\n            var fragment = document.createDocumentFragment();\n            var li = document.createElement(SettingsService_1.SettingsService.settings.html.buttonElement);\n            li.setAttribute(SettingsService_1.SettingsService.settings.dataSelector.action, buttonTypeStr);\n            var icon = this.iconsService.create(buttonTypeStr);\n            //let contentNode = document.createTextNode(content);\n            //li.appendChild(contentNode);\n            li.appendChild(icon);\n            fragment.appendChild(li);\n            this.elementCache[cacheKey] = fragment;\n        }\n        return this.elementCache[cacheKey].cloneNode(true);\n    };\n    DomBuilderService.prototype.buildPopUpDom = function () {\n        var popUp = document.body.querySelectorAll('[data-rml-deeplink-popup-container]');\n        if (popUp && popUp.length > 0) {\n            return popUp[0];\n        }\n        var wrapper = document.createElement('div');\n        wrapper.classList.add('rml-btn-wrapper');\n        wrapper.classList.add('rml-popup__closed');\n        var container = document.createElement('div');\n        container.setAttribute('data-rml-deeplink-popup-container', '');\n        container.classList.add('rml-btn');\n        var modal = document.createElement('div');\n        modal.classList.add('rml-md-modal');\n        modal.classList.add('rml-popup');\n        modal.classList.add('rml-md-effect-1');\n        modal.setAttribute('data-rml-deeplink-popup', '');\n        var content = document.createElement('div');\n        content.classList.add('rml-md-content');\n        var closer = document.createElement('div');\n        closer.classList.add('rml-popup--close');\n        var back = document.createElement('div');\n        back.classList.add('rml-popup--back');\n        var links = document.createElement('div');\n        links.classList.add('rml-generated-content');\n        var overlay = document.createElement('div');\n        overlay.classList.add('rml-md-overlay');\n        modal.appendChild(content);\n        content.appendChild(closer);\n        content.appendChild(back);\n        content.appendChild(links);\n        container.appendChild(modal);\n        wrapper.appendChild(container);\n        wrapper.appendChild(overlay);\n        return wrapper;\n    };\n    DomBuilderService.prototype.buildCustomPopUp = function (content, parent) {\n        if (parent === void 0) { parent = document.body; }\n        var container = this.buildPopUpDom();\n        var contentDiv = container.querySelectorAll('.rml-md-content')[0];\n        var oldContent = contentDiv.querySelector('.rml-generated-content');\n        oldContent.innerHTML = '';\n        if (content) {\n            oldContent.appendChild(content);\n        }\n        var popUp = document.body.querySelectorAll('[data-rml-deeplink-popup-container]');\n        if (!popUp || popUp.length === 0) {\n            parent.appendChild(container);\n            var instanceSelector = SettingsService_1.SettingsService.settings.selector;\n            var element = document.body;\n            PopupController_1.PopupController.parse(instanceSelector, element);\n        }\n    };\n    DomBuilderService.prototype.buildPopUp = function (parent) {\n        if (parent === void 0) { parent = document.body; }\n        var container = this.buildPopUpDom();\n        parent.appendChild(container);\n    };\n    DomBuilderService.prototype.buildAddToPlan = function () {\n        return this.build(ButtonsService_1.BUTTON_TYPE.ADD, 'Plan');\n    };\n    DomBuilderService.prototype.buildVisualize = function () {\n        return this.build(ButtonsService_1.BUTTON_TYPE.VISUALIZE, 'Visualize');\n    };\n    DomBuilderService.prototype.buildConfigure = function () {\n        return this.build(ButtonsService_1.BUTTON_TYPE.CONFIGURE, 'Configure');\n    };\n    DomBuilderService.prototype.buildAR = function () {\n        return this.build(ButtonsService_1.BUTTON_TYPE.AR, 'Augmented Reality');\n    };\n    DomBuilderService.prototype.buildMark = function () {\n        return this.build(ButtonsService_1.BUTTON_TYPE.MARK, 'Mark');\n    };\n    DomBuilderService.prototype.buildVR = function () {\n        return this.build(ButtonsService_1.BUTTON_TYPE.VR, 'Virtual Reality');\n    };\n    DomBuilderService.prototype.buildButtons = function (type) {\n        var _this = this;\n        var cacheKey = '';\n        this.buttonsService.availableButtons.forEach(function (buttonType) {\n            if (_this.mobileDetect.generateLink('', type, buttonType)) {\n                cacheKey += buttonType;\n            }\n        });\n        if (!this.buttonsCache[cacheKey]) {\n            var fragment = document.createDocumentFragment();\n            var div = document.createElement(SettingsService_1.SettingsService.settings.html.containerType);\n            div.classList.add(SettingsService_1.SettingsService.settings.html.containerClass);\n            var ul_1 = document.createElement(SettingsService_1.SettingsService.settings.html.buttonsContainer);\n            var oneAdded_1 = false;\n            this.buttonsService.availableButtons.forEach(function (buttonType) {\n                var link = _this.mobileDetect.generateLink('', type, buttonType);\n                if (!link) {\n                    return;\n                }\n                if (SettingsService_1.SettingsService.settings.showOnlyTrigger) {\n                    oneAdded_1 = true;\n                    return;\n                }\n                if (buttonType === ButtonsService_1.BUTTON_TYPE.ADD) {\n                    var add = _this.buildAddToPlan();\n                    ul_1.appendChild(add);\n                    oneAdded_1 = true;\n                    return;\n                }\n                if (buttonType === ButtonsService_1.BUTTON_TYPE.AR) {\n                    var ar = _this.buildAR();\n                    ul_1.appendChild(ar);\n                    oneAdded_1 = true;\n                    return;\n                }\n                if (buttonType === ButtonsService_1.BUTTON_TYPE.CONFIGURE) {\n                    var conf = _this.buildConfigure();\n                    ul_1.appendChild(conf);\n                    oneAdded_1 = true;\n                    return;\n                }\n                if (buttonType === ButtonsService_1.BUTTON_TYPE.MARK) {\n                    var mark = _this.buildMark();\n                    ul_1.appendChild(mark);\n                    oneAdded_1 = true;\n                    return;\n                }\n                if (buttonType === ButtonsService_1.BUTTON_TYPE.VISUALIZE) {\n                    var vis = _this.buildVisualize();\n                    ul_1.appendChild(vis);\n                    oneAdded_1 = true;\n                    return;\n                }\n                if (buttonType === ButtonsService_1.BUTTON_TYPE.VR) {\n                    var vr = _this.buildVR();\n                    ul_1.appendChild(vr);\n                    oneAdded_1 = true;\n                    return;\n                }\n                ConsoleService_1.ConsoleService.error('ButtonType \"' + buttonType + '\" unknown');\n            });\n            if (oneAdded_1) {\n                var trigger = this.buildTrigger();\n                ul_1.insertBefore(trigger, ul_1.firstChild);\n                div.appendChild(ul_1);\n            }\n            fragment.appendChild(div);\n            this.buttonsCache[cacheKey] = fragment;\n        }\n        return this.buttonsCache[cacheKey].cloneNode(true);\n    };\n    DomBuilderService.prototype.getButtons = function (type) {\n        return this.buildButtons(type);\n    };\n    DomBuilderService.prototype.buildDeeplink = function (type, id, callbackUrl) {\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        var shortenId = 1;\n        var typeStr = 'configuration';\n        if (type === RoomleTypeService_1.ROOMLE_TYPE.CONFIGURATION) {\n            shortenId = 3;\n        }\n        if (type === RoomleTypeService_1.ROOMLE_TYPE.CONFIGURABLE_ITEM || type === RoomleTypeService_1.ROOMLE_TYPE.ITEM) {\n            shortenId = 4;\n            typeStr = 'configurable-item';\n        }\n        if (callbackUrl) {\n            var separator_1 = SettingsService_1.SettingsService.settings.deepLinkInterstitialUrl.indexOf('?') === -1 ? '?' : '&';\n            return new Promise(function (resolve) { return resolve(SettingsService_1.SettingsService.settings.deepLinkInterstitialUrl + separator_1 + 'type=' + typeStr + '&id=' + id + '&callbackUrl=' + encodeURIComponent(callbackUrl)); });\n        }\n        var token = 'anonymous';\n        var today = new Date();\n        var apiKey = 'roomle_portal_v2';\n        var tokenEncoded = today.toISOString() + ';' + token + ';' + apiKey;\n        tokenEncoded = '03-' + window.btoa(tokenEncoded);\n        return this.requestService.fetchJSON(Environment_1.Environment.config.rmlco, {\n            method: 'POST',\n            headers: {\n                'apiKey': 'roomle_portal_v2',\n                'currentTenant': 9,\n                'language': 'en',\n                'locale': 'en',\n                'token': tokenEncoded\n            },\n            body: {\n                shortId: {\n                    type: shortenId,\n                    referencedId: id\n                }\n            }\n        });\n    };\n    DomBuilderService.prototype.isAvailableLink = function (linkType) {\n        if (ButtonsService_1.ButtonsService.convertButtonTypeToEnum(linkType) === ButtonsService_1.BUTTON_TYPE.MARK) {\n            return false;\n        }\n        if (ButtonsService_1.ButtonsService.convertButtonTypeToEnum(linkType) === ButtonsService_1.BUTTON_TYPE.START_NOW) {\n            return false;\n        }\n        return true;\n    };\n    DomBuilderService.prototype.createDeeplinkInput = function (container, link, id, type) {\n        var _this = this;\n        container.innerHTML = '';\n        var input = document.createElement('input');\n        input.setAttribute('type', 'text');\n        input.setAttribute('value', link);\n        input.setAttribute('readonly', 'readonly');\n        input.addEventListener('click', function (e) {\n            e.stopImmediatePropagation();\n            e.preventDefault();\n            input.select();\n            _this.trackingService.trackGAInteraction('ClickedIntoShortUrl:', id, type);\n        });\n        container.appendChild(input);\n        return input;\n    };\n    DomBuilderService.prototype.createCopySvg = function (container, input, id, type) {\n        var _this = this;\n        if (typeof document.execCommand !== 'function') {\n            return;\n        }\n        var copySvg = this.iconsService.createCopy();\n        copySvg.classList.add('rml-clickable');\n        copySvg.classList.add('rml-fake-link');\n        copySvg.classList.add('rml-icons__copy');\n        copySvg.addEventListener('click', function () {\n            input.select();\n            try {\n                _this.trackingService.trackGAInteraction('ClickedCopyCommand:', id, type);\n                document.execCommand('copy');\n            }\n            catch (e) {\n                ConsoleService_1.ConsoleService.error('ClickedCopyCommandFailed \"' + e + '\"');\n                _this.trackingService.trackGAInteraction('ClickedCopyCommandFailed:', id, type);\n            }\n        });\n        container.appendChild(copySvg);\n    };\n    DomBuilderService.prototype.addShortlink = function (element, type, buttonType, id, callbackUrl) {\n        var _this = this;\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        var h3 = element.querySelector('.rml-deeplink--link');\n        var needsAppend = false;\n        if (!h3) {\n            h3 = document.createElement('span');\n            needsAppend = true;\n        }\n        h3.classList.add('rml-deeplink--link');\n        h3.classList.add('rml-deeplink--heading');\n        h3.classList.add('text--red');\n        if (needsAppend) {\n            element.appendChild(h3);\n        }\n        var cacheKey = type + ':' + id + ((callbackUrl) ? callbackUrl : '');\n        var cachedLink = this.shortLinkCache[cacheKey];\n        if (cachedLink) {\n            var inputCached = this.createDeeplinkInput(h3, cachedLink, id, buttonType);\n            this.createCopySvg(h3, inputCached, id, buttonType);\n            this.createQRCode(cachedLink);\n        }\n        else {\n            if (this.waitingForShortLink) {\n                return;\n            }\n            this.waitingForShortLink = true;\n            var spinner_1 = document.createElement('span');\n            spinner_1.classList.add('rml-spinner');\n            spinner_1.classList.add('rml-spinner--white');\n            h3.appendChild(spinner_1);\n            this.buildDeeplink(type, id, callbackUrl).then(function (shortLink) {\n                var link = (!shortLink.shortId) ? shortLink + '&button=' + buttonType : Environment_1.Environment.config.shortlink(RoomleTypeService_1.RoomleTypeService.convertRoomleType(type), id, buttonType, shortLink.shortId.shortId);\n                var input = _this.createDeeplinkInput(h3, link, id, buttonType);\n                _this.createCopySvg(h3, input, id, buttonType);\n                _this.shortLinkCache[cacheKey] = link;\n                _this.createQRCode(link);\n                _this.waitingForShortLink = false;\n            }, function () {\n                _this.waitingForShortLink = false;\n                h3.removeChild(spinner_1);\n                h3.textContent = SettingsService_1.SettingsService.settings.translations.errors.deeplinkcreate;\n            });\n        }\n    };\n    DomBuilderService.prototype.createQRCode = function (link) {\n        var _this = this;\n        var qrCodeElement = document.querySelector('.rml-deeplink__qr');\n        if (!qrCodeElement) {\n            var deepLinkContainer = document.querySelector('.rml-deeplink__hint-link');\n            if (!deepLinkContainer) {\n                deepLinkContainer = document.querySelector('.rml-deeplink--hint');\n            }\n            qrCodeElement = document.createElement('div');\n            qrCodeElement.classList.add('rml-deeplink__qr');\n            deepLinkContainer.appendChild(qrCodeElement);\n        }\n        return new Promise(function (resolve, reject) {\n            var rootUrl = _this.helperService.getRootUrl();\n            _this.scriptLoaderService.fetch(rootUrl + '/qrcode-generator.min.js', { id: 'rml-qr-code-generator' }).then(function () {\n                var qrcode = new window.QRCode(qrCodeElement, {\n                    width: 100,\n                    height: 100,\n                    useSVG: true\n                });\n                qrcode.makeCode(link);\n                resolve();\n            }, reject);\n        });\n    };\n    DomBuilderService.prototype.buildLink = function (link, options) {\n        var _this = this;\n        if (options === void 0) { options = {}; }\n        var _a = options.isHighlighted, isHighlighted = _a === void 0 ? false : _a, _b = options.buildAnyway, buildAnyway = _b === void 0 ? false : _b, _c = options.slideMode, slideMode = _c === void 0 ? false : _c, _d = options.callbackUrl, callbackUrl = _d === void 0 ? null : _d, _e = options.clickedHint, clickedHint = _e === void 0 ? function () {\n        } : _e;\n        if (!this.isAvailableLink(link.type) && !buildAnyway) {\n            return null;\n        }\n        var container = document.createElement('a');\n        container.classList.add('rml-deeplink--row');\n        container.setAttribute('target', '_blank');\n        container.setAttribute('href', link.link);\n        var text = document.createElement('span');\n        text.classList.add('rml-deeplink--text');\n        text.classList.add('rml-deeplink--heading');\n        text.textContent = SettingsService_1.SettingsService.settings.translations[link.type].heading;\n        var icon = document.createElement('span');\n        icon.classList.add('rml-deeplink--icon');\n        var svgIcon = this.iconsService.create(link.type);\n        icon.appendChild(svgIcon); //= 'i';//SettingsService.settings.translations[link.type].icon;\n        container.appendChild(text);\n        container.appendChild(icon);\n        var callback = SettingsService_1.SettingsService.settings.callback.button[link.type];\n        container.addEventListener('click', function () {\n            var type = link.type;\n            var upperCase = type.charAt(0).toUpperCase() + type.substr(1);\n            _this.trackingService.trackGAInteraction(upperCase + 'Clicked:', link.id);\n        });\n        if (callback) {\n            container.addEventListener('click', function () {\n                callback(link.id, RoomleTypeService_1.RoomleTypeService.convertRoomleType(link.roomleType), link.type);\n            });\n        }\n        if (link.alternate) {\n            var alternate_1 = document.createElement('span');\n            alternate_1.classList.add('rml-deeplink--hint');\n            alternate_1.textContent = SettingsService_1.SettingsService.settings.translations[link.type].hint[link.alternate];\n            container.appendChild(alternate_1);\n            container.addEventListener('click', function (e) {\n                e.preventDefault();\n                if (slideMode) {\n                    alternate_1.classList.add('rml-hint__slide');\n                }\n                else {\n                    if (alternate_1.classList.contains('rml-hint__show')) {\n                        alternate_1.classList.remove('rml-hint__show');\n                    }\n                    else {\n                        _this.addShortlink(alternate_1, link.roomleType, link.type, link.id, callbackUrl);\n                        alternate_1.classList.add('rml-hint__show');\n                    }\n                }\n                clickedHint();\n                return false;\n            });\n            if (isHighlighted) {\n                setTimeout(function () {\n                    alternate_1.classList.add('rml-hint__show');\n                    if (slideMode) {\n                        alternate_1.classList.add('rml-hint__slide');\n                        clickedHint();\n                    }\n                    else {\n                        _this.addShortlink(alternate_1, link.roomleType, link.type, link.id, callbackUrl);\n                    }\n                }, 1);\n            }\n        }\n        else {\n            if (link.os !== MobileRedirectService_1.KNOWN_OSS.desktop.name) {\n                this.mobileRedirectService.createDeeplinkFor(container, link.os);\n            }\n        }\n        return container;\n    };\n    return DomBuilderService;\n}(Service_1.Service));\nexports.DomBuilderService = DomBuilderService;\n\n},{\"../config/Environment\":2,\"../controllers/PopupController\":5,\"../lib/Service\":8,\"./ButtonsService\":10,\"./ConsoleService\":11,\"./HelperService\":14,\"./IconsService\":15,\"./MobileDetectService\":17,\"./MobileRedirectService\":18,\"./RequestService\":19,\"./RoomleTypeService\":20,\"./ScriptLoaderService\":21,\"./SettingsService\":22,\"./TrackingService\":23}],13:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar RoomleTypeService_1 = require(\"./RoomleTypeService\");\nvar ButtonsService_1 = require(\"./ButtonsService\");\nvar SettingsService_1 = require(\"./SettingsService\");\nvar MobileDetectService_1 = require(\"./MobileDetectService\");\nvar EVENT_TYPES;\n(function (EVENT_TYPES) {\n    EVENT_TYPES[EVENT_TYPES[\"TRIGGER\"] = 0] = \"TRIGGER\";\n    EVENT_TYPES[EVENT_TYPES[\"POP_UP_OPEN\"] = 1] = \"POP_UP_OPEN\";\n    EVENT_TYPES[EVENT_TYPES[\"POP_UP_CLOSE\"] = 2] = \"POP_UP_CLOSE\";\n})(EVENT_TYPES = exports.EVENT_TYPES || (exports.EVENT_TYPES = {}));\nvar EventHandlerService = (function (_super) {\n    __extends(EventHandlerService, _super);\n    function EventHandlerService() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.mobileDetectService = MobileDetectService_1.MobileDetectService.inject();\n        _this.triggerCallbacks = [];\n        _this.openPopUpCallbacks = [];\n        return _this;\n    }\n    EventHandlerService.prototype.subscribe = function (event, callback) {\n        if (event === EVENT_TYPES.TRIGGER) {\n            this.triggerCallbacks.push(callback);\n        }\n        if (event === EVENT_TYPES.POP_UP_OPEN) {\n            this.openPopUpCallbacks.push(callback);\n        }\n    };\n    EventHandlerService.prototype.findSelector = function (element, selector, depth, maxDepth) {\n        if (depth === void 0) { depth = 0; }\n        if (maxDepth === void 0) { maxDepth = 20; }\n        if (maxDepth === depth) {\n            return null;\n        }\n        if (element.matches && element.matches(selector)) {\n            return element;\n        }\n        if (element.msMatchesSelector && element.msMatchesSelector(selector)) {\n            return element;\n        }\n        var parent = element.parentElement || element.parentNode;\n        if (!parent) {\n            return null;\n        }\n        return this.findSelector(parent, selector, depth + 1);\n    };\n    EventHandlerService.prototype.dispatchOpenPopUp = function (e) {\n        this.openPopUpCallbacks.forEach(function (callback) {\n            callback(e);\n        });\n    };\n    // DO NOT USE ENUM FOR TYPE, BECAUSE CALLBACKS ARE ON \"item\" and not \"0\"\n    EventHandlerService.prototype.dispatch = function (e, type, id, buttonType, highlight, newWindow, callbackUrl) {\n        if (highlight === void 0) { highlight = null; }\n        if (newWindow === void 0) { newWindow = false; }\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        var clickedButton = ButtonsService_1.ButtonsService.convertButtonType(buttonType);\n        var links = this.mobileDetectService.getLinks(id, RoomleTypeService_1.RoomleTypeService.convertTypeToEnum(type));\n        if (buttonType === ButtonsService_1.BUTTON_TYPE.TRIGGER) {\n            var triggerKey = ButtonsService_1.ButtonsService.convertButtonType(ButtonsService_1.BUTTON_TYPE.TRIGGER);\n            var callbackTrigger = SettingsService_1.SettingsService.settings.callback[triggerKey];\n            if (typeof callbackTrigger === 'function') {\n                callbackTrigger(e, id, type, links, highlight, newWindow, callbackUrl);\n            }\n            this.triggerCallbacks.forEach(function (callback) {\n                callback(e, id, type, links, highlight, newWindow, callbackUrl);\n            });\n        }\n        var callbackForType = SettingsService_1.SettingsService.settings.callback[type];\n        if (callbackForType && callbackForType[clickedButton] && typeof callbackForType[clickedButton] === 'function') {\n            callbackForType[clickedButton](e, id, type, links, highlight, newWindow, callbackUrl);\n        }\n    };\n    EventHandlerService.prototype.getElement = function (parent, selector) {\n        var elements = parent.querySelectorAll('[' + selector + ']');\n        if (!elements || elements.length === 0) {\n            if (parent.hasAttribute(selector)) {\n                return parent;\n            }\n        }\n        return elements[0];\n    };\n    EventHandlerService.prototype.handle = function (e) {\n        var target = (e.target || e.srcElement);\n        var button = this.findSelector(target, '[' + SettingsService_1.SettingsService.settings.dataSelector.action + ']');\n        if (!button) {\n            return;\n        }\n        var buttonType = button.getAttribute(SettingsService_1.SettingsService.settings.dataSelector.action);\n        if (buttonType) {\n            var roomleElement = this.findSelector(target, SettingsService_1.SettingsService.settings.selector);\n            if (!roomleElement) {\n                return;\n            }\n            var typeElement = this.getElement(roomleElement, SettingsService_1.SettingsService.settings.dataSelector.type);\n            var type = null;\n            var id = null;\n            if (typeElement) {\n                type = typeElement.getAttribute(SettingsService_1.SettingsService.settings.dataSelector.type);\n            }\n            var idElement = this.getElement(roomleElement, SettingsService_1.SettingsService.settings.dataSelector.id);\n            if (idElement) {\n                id = idElement.getAttribute(SettingsService_1.SettingsService.settings.dataSelector.id);\n            }\n            this.dispatch(e, type, id, ButtonsService_1.ButtonsService.convertButtonTypeToEnum(buttonType));\n        }\n    };\n    return EventHandlerService;\n}(Service_1.Service));\nexports.EventHandlerService = EventHandlerService;\n\n},{\"../lib/Service\":8,\"./ButtonsService\":10,\"./MobileDetectService\":17,\"./RoomleTypeService\":20,\"./SettingsService\":22}],14:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar HelperService = (function (_super) {\n    __extends(HelperService, _super);\n    function HelperService() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    HelperService.prototype.getRootUrl = function () {\n        var scriptId = 'rml-button-lib';\n        var script = document.getElementById(scriptId);\n        if (!script) {\n            return null;\n        }\n        var href = script.getAttribute('src');\n        return href.slice(0, href.lastIndexOf('/'));\n    };\n    return HelperService;\n}(Service_1.Service));\nexports.HelperService = HelperService;\n\n},{\"../lib/Service\":8}],15:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar ButtonsService_1 = require(\"./ButtonsService\");\nvar IconsService = (function (_super) {\n    __extends(IconsService, _super);\n    function IconsService() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    IconsService.prototype.getSvg = function (attributes) {\n        attributes = attributes || {};\n        if (!attributes['width']) {\n            attributes['width'] = '64';\n        }\n        if (!attributes['height']) {\n            attributes['height'] = '64';\n        }\n        //attributes['xmlns'] = IconsService.SVG_NS;\n        var svg = document.createElementNS(IconsService.SVG_NS, 'svg');\n        for (var attribute in attributes) {\n            svg.setAttributeNS(null, attribute, attributes[attribute]);\n        }\n        return svg;\n    };\n    IconsService.prototype.getNode = function (name, attributes) {\n        var element = document.createElementNS(IconsService.SVG_NS, name);\n        for (var attribute in attributes) {\n            element.setAttributeNS(null, attribute, attributes[attribute]);\n        }\n        return element;\n    };\n    IconsService.prototype.buildPlanIcon = function (isPlus) {\n        var svg = this.getSvg({ viewBox: '0 0 50 50' });\n        var firstPath = this.getNode('path', {\n            d: 'M39.72,23.16,31,17.93h0l-.36-.22-5.13-3.07h0l-.36-.22a.33.33,0,0,0-.35,0l-.36.22h0l-13.87,8.3h0l-.36.22a.53.53,0,0,0,0,.85l.36.22h0l5.13,3.07h0l.36.22h0l8.38,5h0l.24.14.12.07a.33.33,0,0,0,.35,0L39.72,24a.53.53,0,0,0,0-.85Zm-5.09,2.4-3.34-2a.33.33,0,0,0-.35,0l-.36.22a.53.53,0,0,0,0,.85l2.8,1.68-8.43,5-7.49-4.48,2.89-1.73a.53.53,0,0,0,0-.85l-.18-.11h0l-.91-.54a.33.33,0,0,0-.35,0l-.36.22a.53.53,0,0,0,0,.85h0l-2.36,1.41L12,23.58l2.36-1.41,2.45,1.47a.34.34,0,0,0,.17,0,.34.34,0,0,0,.17,0l.36-.22a.53.53,0,0,0,0-.85l-1.91-1.14L25,15.82l4.24,2.54-7.85,4.7a.53.53,0,0,0,0,.85l.36.22a.33.33,0,0,0,.35,0l3.84-2.3,1.83,1.1a.34.34,0,0,0,.17,0,.34.34,0,0,0,.17,0l.36-.22a.53.53,0,0,0,0-.85l-1.3-.77,3.3-2,7.49,4.48Z',\n        });\n        /*let secondPath = this.getNode('path', {\n         d: 'M48,21.46L34.61,14.87h0l-0.55-.27-7.83-3.87h0l-0.55-.27a0.6,0.6,0,0,0-.53,0l-0.55.27h0L3.42,21.19h0l-0.55.27a0.6,0.6,0,0,0,0,1.08l0.55,0.27h0l7.83,3.87h0l0.55,0.27h0l12.8,6.32h0L25,33.45l0.18,0.09a0.61,0.61,0,0,0,.53,0L48,22.54A0.6,0.6,0,0,0,48,21.46Zm-7.77,3L35.09,22a0.6,0.6,0,0,0-.53,0L34,22.24a0.6,0.6,0,0,0,0,1.08l4.28,2.11L25.41,31.79,14,26.14,18.39,24a0.6,0.6,0,0,0,0-1.08l-0.28-.14h0l-1.39-.69a0.6,0.6,0,0,0-.53,0l-0.55.27a0.6,0.6,0,0,0,0,1.08h0l-3.6,1.78L5.59,22l3.6-1.78,3.74,1.85a0.61,0.61,0,0,0,.27.06,0.6,0.6,0,0,0,.27-0.06L14,21.8a0.6,0.6,0,0,0,0-1.08l-2.92-1.44,14.32-7.07,6.48,3.2-12,5.92a0.6,0.6,0,0,0,0,1.08l0.55,0.27a0.6,0.6,0,0,0,.53,0l5.86-2.89,2.8,1.38a0.61,0.61,0,0,0,.27.06,0.6,0.6,0,0,0,.27-0.06l0.55-.27a0.6,0.6,0,0,0,0-1.08l-2-1,5-2.49L45.24,22Z',\n         transform: 'translate(-2.53 -10.4)'\n         });*/\n        svg.appendChild(firstPath);\n        //svg.appendChild(secondPath);\n        if (isPlus) {\n            var thirdPath = this.getNode('path', {\n                d: 'M37.29,33.15v2.48h-1.4V33.15H33.42v-1.4h2.47V29.29h1.4v2.46h2.47v1.4Z',\n            });\n            svg.appendChild(thirdPath);\n        }\n        return svg;\n    };\n    IconsService.prototype.buildAdd = function () {\n        return this.buildPlanIcon(true);\n    };\n    IconsService.prototype.buildPlanNow = function () {\n        return this.buildPlanIcon(false);\n    };\n    IconsService.prototype.buildAr = function () {\n        var svg = this.getSvg({ viewBox: '0 0 50 50' });\n        var firstPath = this.getNode('path', {\n            d: 'M24.41,33.24h0c-5.22-.08-9.5-2.78-14.31-9a.75.75,0,0,1-.16-.46c0-.63,4.46-6.73,10.67-8.84,8.34-2.84,15,3,19.19,8.38a.75.75,0,0,1,.16.46c0,.45-.63,1.34-1.87,2.63a.75.75,0,0,1-1.09-1,13.24,13.24,0,0,0,1.3-1.52c-4.4-5.57-9-8.3-13.69-8.15-6.69.23-11.71,6.36-13,8.06,5.49,7,9.55,8,12.8,8a.75.75,0,0,1,0,1.5Z',\n        });\n        var secondPath = this.getNode('path', {\n            d: 'M24.94,29.4a5.42,5.42,0,0,1-5.05-3.5,5.58,5.58,0,0,1,1.56-6.51,5.3,5.3,0,0,1,6.44-.3,5.66,5.66,0,0,1,2.34,6.39A.75.75,0,1,1,28.79,25a4.18,4.18,0,0,0-1.74-4.7,3.79,3.79,0,0,0-4.65.21,4.12,4.12,0,0,0-1.12,4.79,3.9,3.9,0,0,0,4,2.55.74.74,0,0,1,.81.69.75.75,0,0,1-.69.81Z',\n        });\n        var graph = this.getNode('g');\n        var thirdPath = this.getNode('path', {\n            d: 'M30.5,35.1,30,33.68H27.18L26.7,35.1H25.06l2.92-8h1.23l2.93,8Zm-1.87-5.65-1,2.92h2Z',\n        });\n        var fourthPath = this.getNode('path', {\n            d: 'M37.39,35.1l-1.57-3.2H34.69v3.2H33.13v-8h3.14a2.42,2.42,0,0,1,2.6,2.46,2.16,2.16,0,0,1-1.46,2.11L39.2,35.1Zm-1.22-6.62H34.69v2.12h1.48a1.06,1.06,0,1,0,0-2.12Z',\n        });\n        graph.appendChild(thirdPath);\n        graph.appendChild(fourthPath);\n        svg.appendChild(firstPath);\n        svg.appendChild(secondPath);\n        svg.appendChild(graph);\n        return svg;\n    };\n    IconsService.prototype.buildConfigure = function () {\n        var svg = this.getSvg({ viewBox: '0 0 50 50' });\n        var path = this.getNode('path', {\n            d: 'M34.67,10.9,28.9,8.22a1.87,1.87,0,0,0-2.48.91L16,31.42a1.86,1.86,0,0,0-.17.75L15.66,40a1.85,1.85,0,0,0,.53,1.34,1.9,1.9,0,0,0,1.35.57,1.86,1.86,0,0,0,1.23-.47l5.93-5.22a1.86,1.86,0,0,0,.46-.62L35.58,13.37A1.88,1.88,0,0,0,34.67,10.9ZM17.47,40.22l.14-7,4.91,2.55ZM32,16.94l-5.88-2.73,1.94-4.38L34,12.57Z',\n        });\n        svg.appendChild(path);\n        return svg;\n    };\n    IconsService.prototype.buildMark = function () {\n        var svg = this.getSvg({ viewBox: '0 0 50 50' });\n        var path = this.getNode('path', {\n            d: 'M32.16,12.05A7.89,7.89,0,0,0,25,16.51,7.93,7.93,0,0,0,10,20C10,29.35,25,39.64,25,39.64s15-10.37,15-19.66A7.91,7.91,0,0,0,32.16,12.05Z',\n        });\n        svg.appendChild(path);\n        return svg;\n    };\n    IconsService.prototype.buildCopy = function () {\n        var svg = this.getSvg({ viewBox: '0 0 32 32' });\n        var firstPath = this.getNode('path', {\n            d: 'M28.681 11.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-11.5c-1.379 0-2.5 1.122-2.5 2.5v23c0 1.378 1.121 2.5 2.5 2.5h19c1.378 0 2.5-1.122 2.5-2.5v-15.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 9.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268v0zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-19c-0.271 0-0.5-0.229-0.5-0.5v-23c0-0.271 0.229-0.5 0.5-0.5 0 0 11.499-0 11.5 0v7c0 0.552 0.448 1 1 1h7v15.5z',\n        });\n        var secondPath = this.getNode('path', {\n            d: 'M18.841 1.319c-1.612-1.182-2.393-1.319-2.841-1.319h-11.5c-1.378 0-2.5 1.121-2.5 2.5v23c0 1.207 0.86 2.217 2 2.45v-25.45c0-0.271 0.229-0.5 0.5-0.5h15.215c-0.301-0.248-0.595-0.477-0.873-0.681z',\n        });\n        svg.appendChild(firstPath);\n        svg.appendChild(secondPath);\n        return svg;\n    };\n    IconsService.prototype.buildTrigger = function () {\n        var svg = this.getSvg({ viewBox: '0 0 32.19 29.5' });\n        var path1 = this.getNode('path', {\n            d: 'M21,22.36c-1.57,0-1.87,1.36-1.87,3s0.17,3,1.87,3,1.87-1.36,1.87-3S22.59,22.36,21,22.36Z',\n            transform: 'translate(-9 -15.26)'\n        });\n        var path2 = this.getNode('path', {\n            d: 'M31.1,22.36c-1.57,0-1.87,1.36-1.87,3s0.17,3,1.87,3S33,27,33,25.36,32.66,22.36,31.1,22.36Z',\n            transform: 'translate(-9 -15.26)'\n        });\n        var path3 = this.getNode('path', {\n            d: 'M26,15.26c-5.86,0-17,.73-17,3.48V31.89a1.16,1.16,0,0,0,.17.49c1,2.06,9.46,3,16.85,3,5.86,0,17-.73,17-3.48V18.74C43,16,31.86,15.26,26,15.26ZM21,30.11c-3.46,0-4.69-2.14-4.69-4.79S17.6,20.53,21,20.53s4.69,2.14,4.69,4.79S24.47,30.11,21,30.11Zm10.08,0c-3.46,0-4.69-2.14-4.69-4.79s1.28-4.79,4.69-4.79,4.69,2.14,4.69,4.79S34.55,30.11,31.1,30.11Z',\n            transform: 'translate(-9 -15.26)'\n        });\n        var path4 = this.getNode('path', {\n            d: 'M31.1,28.36c-1.7,0-1.87-1.36-1.87-3s0.3-3,1.87-3,1.87,1.36,1.87,3S32.8,28.36,31.1,28.36Z',\n            transform: 'translate(-9 -15.26)'\n        });\n        var path5 = this.getNode('path', {\n            d: 'M21,28.36c-1.7,0-1.87-1.36-1.87-3s0.3-3,1.87-3,1.87,1.36,1.87,3S22.72,28.36,21,28.36Z',\n            transform: 'translate(-9 -15.26)'\n        });\n        svg.appendChild(path1);\n        svg.appendChild(path2);\n        svg.appendChild(path3);\n        svg.appendChild(path4);\n        svg.appendChild(path5);\n        return svg;\n    };\n    IconsService.prototype.buildVisualize = function () {\n        var svg = this.getSvg({ viewBox: '0 0 50 50' });\n        var path = this.getNode('path', {\n            d: 'M25,34.59c-6.32,0-11.44-4.71-14.84-9.13a.75.75,0,0,1,0-.87c.24-.36,6-8.87,14.49-9.17C29.9,15.23,35,18.3,39.85,24.55A.74.74,0,0,1,40,25c0,.6-4.61,6.78-10.68,8.84A13.47,13.47,0,0,1,25,34.59ZM11.65,25c4.4,5.55,9,8.28,13.68,8.12,6.7-.23,11.74-6.38,13-8.08-4.4-5.55-9-8.28-13.69-8.12C17.93,17.14,12.91,23.28,11.65,25ZM25,30.49A5.49,5.49,0,1,1,30.38,25,5.45,5.45,0,0,1,25,30.49ZM25,21a4,4,0,1,0,3.91,4A4,4,0,0,0,25,21Z',\n        });\n        svg.appendChild(path);\n        return svg;\n    };\n    IconsService.prototype.buildVr = function () {\n        var svg = this.getSvg({ viewBox: '0 0 50 50' });\n        var path = this.getNode('path', {\n            d: 'M37.88,16.24H12.18A2.16,2.16,0,0,0,10,18.4V31.6a2.16,2.16,0,0,0,2.16,2.16H20a1.54,1.54,0,0,0,1.46-.93l1.75-4.38a1.92,1.92,0,0,1,3.5.06l1.52,4.26a1.59,1.59,0,0,0,1.46,1h8.12A2.16,2.16,0,0,0,40,31.6V18.46A2.05,2.05,0,0,0,37.88,16.24ZM18.6,28.8a3.33,3.33,0,0,1-3.33-3.33,3.33,3.33,0,1,1,6.66,0A3.33,3.33,0,0,1,18.6,28.8Zm12.85,0a3.33,3.33,0,0,1-3.33-3.33,3.33,3.33,0,0,1,6.66,0A3.33,3.33,0,0,1,31.45,28.8Z',\n        });\n        svg.appendChild(path);\n        return svg;\n    };\n    IconsService.prototype.create = function (buttonType) {\n        var button = ButtonsService_1.ButtonsService.convertButtonTypeToEnum(buttonType);\n        if (button === ButtonsService_1.BUTTON_TYPE.ADD) {\n            return this.buildAdd();\n        }\n        if (button === ButtonsService_1.BUTTON_TYPE.AR) {\n            return this.buildAr();\n        }\n        if (button === ButtonsService_1.BUTTON_TYPE.CONFIGURE) {\n            return this.buildConfigure();\n        }\n        if (button === ButtonsService_1.BUTTON_TYPE.VISUALIZE) {\n            return this.buildVisualize();\n        }\n        if (button === ButtonsService_1.BUTTON_TYPE.VR) {\n            return this.buildVr();\n        }\n        if (button === ButtonsService_1.BUTTON_TYPE.TRIGGER) {\n            return this.buildTrigger();\n        }\n        if (button === ButtonsService_1.BUTTON_TYPE.MARK) {\n            return this.buildMark();\n        }\n        if (button === ButtonsService_1.BUTTON_TYPE.START_NOW) {\n            return this.buildPlanNow();\n        }\n        return null;\n    };\n    IconsService.prototype.createCopy = function () {\n        return this.buildCopy();\n    };\n    return IconsService;\n}(Service_1.Service));\nIconsService.SVG_NS = 'http://www.w3.org/2000/svg';\nexports.IconsService = IconsService;\n\n},{\"../lib/Service\":8,\"./ButtonsService\":10}],16:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar ImagesService = (function (_super) {\n    __extends(ImagesService, _super);\n    function ImagesService() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.images = {\n            ios: 'https://a.storyblok.com/f/4e779959c8/ios.png',\n            android: 'https://a.storyblok.com/f/1386db8cd0/android.png',\n            desktop: 'https://a.storyblok.com/f/cf5aa03c64/desktop.png',\n        };\n        return _this;\n    }\n    ImagesService.prototype.preloadImages = function () {\n        var ios = new Image();\n        var android = new Image();\n        var desktop = new Image();\n        ios.src = this.images.ios;\n        android.src = this.images.android;\n        desktop.src = this.images.desktop;\n    };\n    return ImagesService;\n}(Service_1.Service));\nexports.ImagesService = ImagesService;\n\n},{\"../lib/Service\":8}],17:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar RoomleTypeService_1 = require(\"./RoomleTypeService\");\nvar ButtonsService_1 = require(\"./ButtonsService\");\nvar SettingsService_1 = require(\"./SettingsService\");\nvar MobileRedirectService_1 = require(\"./MobileRedirectService\");\nvar MobileDetectService = (function (_super) {\n    __extends(MobileDetectService, _super);\n    function MobileDetectService() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.isOSCached = null;\n        _this.isAndroidCached = null;\n        _this.isIPadCached = null;\n        _this.isSupportedMobileCached = null;\n        _this.buttonsService = ButtonsService_1.ButtonsService.inject();\n        return _this;\n    }\n    MobileDetectService.prototype.isIOS = function () {\n        if (this.isOSCached !== null) {\n            return this.isOSCached;\n        }\n        return /iPad|iPhone|iPod/i.test(navigator.userAgent) && !window.MSStream; // USE MSStream because of http://stackoverflow.com/a/9039885\n    };\n    MobileDetectService.prototype.isDesktop = function () {\n        return !this.isAndroid() && !this.isIOS();\n    };\n    MobileDetectService.prototype.isAndroid = function () {\n        if (this.isAndroidCached !== null) {\n            return this.isAndroidCached;\n        }\n        return /Android/i.test(navigator.userAgent) && !window.MSStream; // USE MSStream because of http://stackoverflow.com/a/9039885\n    };\n    MobileDetectService.prototype.getOS = function () {\n        var os = MobileRedirectService_1.KNOWN_OSS.ios.name;\n        if (this.isAndroid()) {\n            os = MobileRedirectService_1.KNOWN_OSS.android.name;\n        }\n        else if (this.isDesktop()) {\n            os = MobileRedirectService_1.KNOWN_OSS.desktop.name;\n        }\n        return os;\n    };\n    MobileDetectService.prototype.isSupportedMobile = function () {\n        if (this.isSupportedMobileCached !== null) {\n            return this.isSupportedMobileCached;\n        }\n        return this.isIOS() || this.isAndroid();\n    };\n    MobileDetectService.prototype.isIPad = function () {\n        if (this.isIPadCached !== null) {\n            return this.isIPadCached;\n        }\n        return /iPad/i.test(navigator.userAgent) && !window.MSStream; // USE MSStream because of http://stackoverflow.com/a/9039885\n    };\n    MobileDetectService.prototype.handlePlan = function (id, type, buttonType) {\n        var buttonTypeStr = ButtonsService_1.ButtonsService.convertButtonType(buttonType);\n        var typeStr = type;\n        var iosPlanLink = 'roomle://3d/planId/' + id;\n        var desktopLink = SettingsService_1.SettingsService.settings.web.baseUrl + 't/planner?id=' + id;\n        if (buttonType === ButtonsService_1.BUTTON_TYPE.VISUALIZE) {\n            if (this.isAndroid()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: null,\n                    link: iosPlanLink,\n                    os: MobileRedirectService_1.KNOWN_OSS.android.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            if (this.isIOS()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: null,\n                    link: this.getIosLink(iosPlanLink),\n                    os: MobileRedirectService_1.KNOWN_OSS.ios.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            return {\n                type: buttonTypeStr,\n                alternate: null,\n                link: desktopLink,\n                os: MobileRedirectService_1.KNOWN_OSS.desktop.name,\n                roomleType: typeStr,\n                id: id\n            };\n        }\n        if (buttonType === ButtonsService_1.BUTTON_TYPE.VR) {\n            var viewrLink = 'roomleviewer://vr/' + id;\n            if (this.isAndroid()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: null,\n                    link: this.getAndroidLink(viewrLink),\n                    os: MobileRedirectService_1.KNOWN_OSS.android.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            if (this.isIOS()) {\n                return { type: buttonTypeStr, alternate: null, link: this.getIosLink(viewrLink), os: MobileRedirectService_1.KNOWN_OSS.ios.name, roomleType: typeStr, id: id };\n            }\n            return { type: buttonTypeStr, alternate: MobileRedirectService_1.KNOWN_OSS.ios.name, link: viewrLink, os: MobileRedirectService_1.KNOWN_OSS.desktop.name, roomleType: typeStr, id: id };\n        }\n        if (buttonType === ButtonsService_1.BUTTON_TYPE.START_NOW) {\n            var viewrLink = 'roomleviewer://plan/' + id;\n            if (this.isAndroid()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: null,\n                    link: this.getAndroidLink(viewrLink),\n                    os: MobileRedirectService_1.KNOWN_OSS.android.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            if (this.isIOS()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: null,\n                    link: this.getIosLink(iosPlanLink),\n                    os: MobileRedirectService_1.KNOWN_OSS.ios.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            return {\n                type: buttonTypeStr,\n                alternate: null,\n                link: desktopLink,\n                os: MobileRedirectService_1.KNOWN_OSS.desktop.name,\n                roomleType: typeStr,\n                id: id\n            };\n        }\n        return null;\n    };\n    MobileDetectService.prototype.getAndroidLink = function (deeplinkUrl) {\n        var locale = 'en';\n        if (SettingsService_1.SettingsService.settings.locale.indexOf('de') !== -1) {\n            locale = 'de';\n        }\n        return SettingsService_1.SettingsService.getInstance().settings.baseServer + locale + '/android/get-the-app?deeplink=' + this.encodeUrl(deeplinkUrl);\n    };\n    MobileDetectService.prototype.getIosLink = function (deeplinkUrl) {\n        var locale = 'en';\n        if (SettingsService_1.SettingsService.settings.locale.indexOf('de') !== -1) {\n            locale = 'de';\n        }\n        return SettingsService_1.SettingsService.getInstance().settings.baseServer + locale + '/ios/get-the-app?deeplink=' + this.encodeUrl(deeplinkUrl);\n    };\n    MobileDetectService.prototype.encodeUrl = function (deeplinkUrl) {\n        return encodeURIComponent(deeplinkUrl);\n    };\n    MobileDetectService.prototype.createLinkForItemOrConfiguration = function (id, type, buttonType, isItem) {\n        var typeStr = type;\n        var buttonTypeStr = ButtonsService_1.ButtonsService.convertButtonType(buttonType);\n        if (isItem) {\n        }\n        var iosIdentifier = (!isItem && type !== RoomleTypeService_1.ROOMLE_TYPE.CONFIGURABLE_ITEM) ? 'configurationId' : 'catalogItemId';\n        var webIdentifier = (!isItem && type !== RoomleTypeService_1.ROOMLE_TYPE.CONFIGURABLE_ITEM) ? 'configurationId[]' : 'itemId[]';\n        if (buttonType === ButtonsService_1.BUTTON_TYPE.ADD) {\n            var desktopLink = SettingsService_1.SettingsService.settings.web.baseUrl + 'editor/' + SettingsService_1.SettingsService.settings.planId + '?' + webIdentifier + '=' + id;\n            var iosLink = 'roomle://addToPlan/' + iosIdentifier + '/' + id;\n            if (this.isAndroid()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: MobileRedirectService_1.KNOWN_OSS.desktop.name,\n                    link: desktopLink,\n                    os: MobileRedirectService_1.KNOWN_OSS.android.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            if (this.isIOS()) {\n                return { type: buttonTypeStr, alternate: null, link: this.getIosLink(iosLink), os: 'ios', roomleType: typeStr, id: id };\n            }\n            return {\n                type: buttonTypeStr,\n                alternate: null,\n                link: desktopLink,\n                os: MobileRedirectService_1.KNOWN_OSS.desktop.name,\n                roomleType: typeStr,\n                id: id\n            };\n        }\n        if (buttonType === ButtonsService_1.BUTTON_TYPE.AR) {\n            var iosLink = 'roomle://ar/' + iosIdentifier + '/' + id;\n            if (this.isAndroid()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: null,\n                    link: this.getAndroidLink(iosLink),\n                    os: MobileRedirectService_1.KNOWN_OSS.android.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            if (this.isIOS()) {\n                return { type: buttonTypeStr, alternate: null, link: this.getIosLink(iosLink), os: MobileRedirectService_1.KNOWN_OSS.ios.name, roomleType: typeStr, id: id };\n            }\n            return { type: buttonTypeStr, alternate: MobileRedirectService_1.KNOWN_OSS.ios.name, link: iosLink, os: MobileRedirectService_1.KNOWN_OSS.desktop.name, roomleType: typeStr, id: id };\n        }\n        if (buttonType === ButtonsService_1.BUTTON_TYPE.CONFIGURE && (type === RoomleTypeService_1.ROOMLE_TYPE.CONFIGURATION || type === RoomleTypeService_1.ROOMLE_TYPE.CONFIGURABLE_ITEM)) {\n            var isConfigurableItem = (type === RoomleTypeService_1.ROOMLE_TYPE.CONFIGURATION) ? false : true;\n            var desktopLink = SettingsService_1.SettingsService.settings.baseServer + 't/configurator/?id=' + id + (isConfigurableItem ? '&isItem=true' : '') + 'enableHD=true';\n            if (typeof SettingsService_1.SettingsService.settings.web.configuratorUrl === 'string') {\n                desktopLink = SettingsService_1.SettingsService.settings.web.configuratorUrl.replace('<[ID]>', id).replace('<[TYPE]>', RoomleTypeService_1.RoomleTypeService.convertRoomleType(type));\n            }\n            var iosLink = 'roomle://configuration/' + iosIdentifier + '/' + id;\n            if (this.isAndroid()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: null,\n                    link: this.getAndroidLink(iosLink),\n                    os: MobileRedirectService_1.KNOWN_OSS.android.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            if (this.isIOS()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: null,\n                    link: this.getIosLink(iosLink),\n                    os: MobileRedirectService_1.KNOWN_OSS.ios.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            return {\n                type: buttonTypeStr,\n                alternate: null,\n                link: desktopLink,\n                os: MobileRedirectService_1.KNOWN_OSS.desktop.name,\n                roomleType: typeStr,\n                id: id\n            };\n        }\n        if (buttonType === ButtonsService_1.BUTTON_TYPE.MARK) {\n            if (this.isAndroid()) {\n                return null;\n            }\n            if (this.isIOS()) {\n                return null;\n            }\n            return null;\n        }\n        if (buttonType === ButtonsService_1.BUTTON_TYPE.VISUALIZE) {\n            if (this.isAndroid()) {\n                return {\n                    type: buttonTypeStr,\n                    alternate: null,\n                    link: this.getAndroidLink('roomleviewer://item/' + id),\n                    os: MobileRedirectService_1.KNOWN_OSS.android.name,\n                    roomleType: typeStr,\n                    id: id\n                };\n            }\n            if (this.isIOS()) {\n                return null;\n            }\n            return null; // {type: buttonTypeStr, alternate: '', link: 'www.roomle'};\n        }\n        return null;\n    };\n    MobileDetectService.prototype.handleItem = function (id, type, buttonType) {\n        var isItem = true;\n        return this.createLinkForItemOrConfiguration(id, type, buttonType, isItem);\n    };\n    MobileDetectService.prototype.handleConfiguration = function (id, type, buttonType) {\n        var isItem = false;\n        return this.createLinkForItemOrConfiguration(id, type, buttonType, isItem);\n    };\n    MobileDetectService.prototype.generateLink = function (id, type, buttonType, callbackUrl) {\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        var deeplink = null;\n        if (type === RoomleTypeService_1.ROOMLE_TYPE.ITEM) {\n            deeplink = this.handleItem(id, type, buttonType);\n        }\n        else if (type === RoomleTypeService_1.ROOMLE_TYPE.CONFIGURATION || type === RoomleTypeService_1.ROOMLE_TYPE.CONFIGURABLE_ITEM) {\n            deeplink = this.handleConfiguration(id, type, buttonType);\n        }\n        else if (type === RoomleTypeService_1.ROOMLE_TYPE.PLAN) {\n            deeplink = this.handlePlan(id, type, buttonType);\n        }\n        if (!deeplink) {\n            return null;\n        }\n        var seperator = deeplink.link.indexOf('?') !== -1 && !this.isAndroid() ? '&' : '?';\n        var isDesktop = this.isDesktop();\n        deeplink.link = (callbackUrl && !isDesktop) ? deeplink.link + seperator + 'callback=' + callbackUrl : deeplink.link;\n        return deeplink;\n    };\n    MobileDetectService.prototype.getLinks = function (id, type, callbackUrl) {\n        var _this = this;\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        var availableButtons = this.buttonsService.availableButtons;\n        var links = [];\n        availableButtons.forEach(function (button) {\n            var link = _this.generateLink(id, type, button, callbackUrl);\n            if (link) {\n                links.push(link);\n            }\n        });\n        return links;\n    };\n    return MobileDetectService;\n}(Service_1.Service));\nexports.MobileDetectService = MobileDetectService;\n\n},{\"../lib/Service\":8,\"./ButtonsService\":10,\"./MobileRedirectService\":18,\"./RoomleTypeService\":20,\"./SettingsService\":22}],18:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar MobileDetectService_1 = require(\"./MobileDetectService\");\nvar ConsoleService_1 = require(\"./ConsoleService\");\nvar hasVisibilityListener = false;\nvar deeplinkInterstitialId = 'deeplink-interstitial';\nexports.KNOWN_OSS = {\n    android: {\n        storePrefix: 'https://play.google.com/store/apps/details?id=',\n        name: 'android'\n    },\n    ios: {\n        storePrefix: 'https://itunes.apple.com/app/',\n        name: 'ios'\n    },\n    desktop: {\n        name: 'desktop'\n    }\n};\nvar MobileRedirectService = (function (_super) {\n    __extends(MobileRedirectService, _super);\n    function MobileRedirectService() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.mobileDetectService = MobileDetectService_1.MobileDetectService.inject();\n        _this.delay = 1200;\n        _this.oss = exports.KNOWN_OSS;\n        return _this;\n    }\n    MobileRedirectService.prototype.getTime = function () {\n        return new Date().getTime();\n    };\n    MobileRedirectService.prototype.copyInputToClipboard = function (url) {\n        var input = document.createElement('input');\n        var inputId = 'hidden-input-for-clipboard';\n        input.id = inputId;\n        input.value = url;\n        document.body.appendChild(input);\n        // lifted from https://stackoverflow.com/a/43001673/1280401\n        if (this.mobileDetectService.isIOS()) {\n            var editable = input.contentEditable;\n            var readOnly = input.readOnly;\n            input.contentEditable = 'true';\n            input.readOnly = false;\n            var range = document.createRange();\n            range.selectNodeContents(input);\n            var selection = window.getSelection();\n            selection.removeAllRanges();\n            selection.addRange(range);\n            input.setSelectionRange(0, 999999);\n            input.contentEditable = editable;\n            input.readOnly = readOnly;\n        }\n        else {\n            input.select();\n        }\n        try {\n            document.execCommand('copy');\n        }\n        catch (e) {\n            ConsoleService_1.ConsoleService.error('document.execCommand(\\'copy\\') failed \"' + e + '\"');\n        }\n        document.body.removeChild(input);\n    };\n    MobileRedirectService.prototype.open = function (url, newWindow, os, callback, doCopy, useTimeout, wasDeviceSwitch) {\n        if (newWindow === void 0) { newWindow = false; }\n        if (callback === void 0) { callback = null; }\n        if (doCopy === void 0) { doCopy = true; }\n        if (useTimeout === void 0) { useTimeout = false; }\n        if (wasDeviceSwitch === void 0) { wasDeviceSwitch = false; }\n        if (doCopy) {\n            this.copyInputToClipboard(url);\n        }\n        if (typeof callback === 'function') {\n            return callback(url);\n        }\n        // NEVER OPEN POPUP BECAUSE IT SEEMS LIKE SAFARI BLOCKS ALL THE POPUPS\n        /*if (url.indexOf('http') === 0 && !wasDeviceSwitch) {\n         const myWindow = window.open(url);\n         (<any>window).closePopUp = function () {\n         myWindow.close();\n         };\n         } else {*/\n        try {\n            var isInIframe = function () {\n                try {\n                    return window.self !== window.top;\n                }\n                catch (e) {\n                    return true;\n                }\n            };\n            if (os === 'ios' && url.indexOf('roomle') === 0) {\n                try {\n                    window.open(url, '_blank', '', false);\n                }\n                catch (iosE) {\n                    ConsoleService_1.ConsoleService.error('window.open(url, _blank, \"\", false) did fail \"' + iosE + '\"');\n                    window.location.href = url;\n                }\n            }\n            else {\n                if (os === 'ios' && isInIframe()) {\n                    var visibilityHandler_1 = function () {\n                        var interstitialIframe = document.getElementById(deeplinkInterstitialId);\n                        if (interstitialIframe) {\n                            document.body.removeChild(interstitialIframe);\n                            document.removeEventListener('visibilitychange', visibilityHandler_1);\n                            hasVisibilityListener = false;\n                        }\n                    };\n                    if (!hasVisibilityListener) {\n                        document.addEventListener('visibilitychange', visibilityHandler_1);\n                        hasVisibilityListener = true;\n                    }\n                    var iframe = document.createElement('iframe');\n                    iframe.src = url;\n                    iframe.style.border = 'none';\n                    iframe.style.width = '100%';\n                    iframe.style.height = '100%';\n                    iframe.style.position = 'fixed';\n                    iframe.style.top = '0';\n                    iframe.style.left = '0';\n                    iframe.style.right = '0';\n                    iframe.style.bottom = '0';\n                    iframe.style.zIndex = '99999';\n                    iframe.id = deeplinkInterstitialId;\n                    document.body.appendChild(iframe);\n                    window.scrollTo(0, 0);\n                }\n                else {\n                    window.location.href = url;\n                }\n            }\n        }\n        catch (e) {\n            ConsoleService_1.ConsoleService.error('window.location.href = url did fail \"' + e + '\"');\n            window.open(url, '_blank', '', false);\n        }\n        //}\n    };\n    MobileRedirectService.prototype.handleAndroidBrowsers = function (appId, href, scheme) {\n        // Android Mobile\n        var isAndroidMobile = navigator.userAgent.indexOf('Android') > -1 &&\n            navigator.userAgent.indexOf('Mozilla/5.0') > -1 &&\n            navigator.userAgent.indexOf('AppleWebKit') > -1;\n        // Android Browser (not Chrome)\n        var regExAppleWebKit = new RegExp('AppleWebKit\\/([\\d.]+)');\n        var resultAppleWebKitRegEx = regExAppleWebKit.exec(navigator.userAgent);\n        var appleWebKitVersion = (resultAppleWebKitRegEx === null ? null : parseFloat(regExAppleWebKit.exec(navigator.userAgent)[1]));\n        var isAndroidBrowser = isAndroidMobile && appleWebKitVersion !== null && appleWebKitVersion > 500;\n        if (isAndroidBrowser) {\n            return 'intent:' + href.split(':')[1] + '#Intent;scheme=' + scheme + ';package=' +\n                appId + ';S.browser_fallback_url=' + encodeURI(href);\n        }\n        else {\n            return href;\n        }\n    };\n    MobileRedirectService.prototype.redirect = function (deeplink, newWindow, callback, callbackUrl, wasDeviceSwitch) {\n        if (newWindow === void 0) { newWindow = false; }\n        if (callback === void 0) { callback = null; }\n        if (callbackUrl === void 0) { callbackUrl = null; }\n        if (wasDeviceSwitch === void 0) { wasDeviceSwitch = false; }\n        this.perfromDeepLink(deeplink.link, deeplink.os, newWindow, callback, false, wasDeviceSwitch);\n    };\n    MobileRedirectService.prototype.redirectTo = function (link, newWindow, callback, useTimeout) {\n        if (newWindow === void 0) { newWindow = false; }\n        if (callback === void 0) { callback = null; }\n        if (useTimeout === void 0) { useTimeout = false; }\n        this.perfromDeepLink(link, this.mobileDetectService.getOS(), newWindow, callback, useTimeout);\n    };\n    MobileRedirectService.prototype.redirectToStore = function (deeplink, newWindow, callback, useTimeout) {\n        if (newWindow === void 0) { newWindow = false; }\n        if (callback === void 0) { callback = null; }\n        if (useTimeout === void 0) { useTimeout = false; }\n        this.copyInputToClipboard(deeplink);\n        var os = this.mobileDetectService.getOS();\n        var osData = this.oss[os];\n        if (!osData || !osData.storePrefix) {\n            return;\n        }\n        var parsedLink = this.parseHref(deeplink, osData.name);\n        this.open(osData.storePrefix + parsedLink.appId, newWindow, osData.name, callback, true, useTimeout);\n    };\n    MobileRedirectService.prototype.perfromDeepLink = function (href, os, newWindow, callback, useTimeout, wasDeviceSwitch) {\n        if (newWindow === void 0) { newWindow = false; }\n        if (callback === void 0) { callback = null; }\n        if (useTimeout === void 0) { useTimeout = false; }\n        if (wasDeviceSwitch === void 0) { wasDeviceSwitch = false; }\n        var data = this.parseHref(href, os);\n        var scheme = data.scheme;\n        var appId = data.appId;\n        var finalURI = this.handleAndroidBrowsers(appId, href, scheme);\n        this.open(finalURI, newWindow, os, callback, true, false, wasDeviceSwitch);\n    };\n    MobileRedirectService.prototype.parseHref = function (href, osin) {\n        var hrefParts = href.split(':');\n        var scheme = hrefParts[0];\n        var appId = 'roomle/id732050356';\n        if (scheme === 'roomleviewer') {\n            appId = 'com.roomle.viewer';\n            if (osin === exports.KNOWN_OSS.ios.name) {\n                appId = 'roomle-viewr/id1053860177';\n            }\n        }\n        else if (osin === exports.KNOWN_OSS.android.name) {\n            appId = 'com.roomle.android';\n        }\n        return { appId: appId, scheme: scheme, os: osin };\n    };\n    MobileRedirectService.prototype.createDeeplinkFor = function (el, os) {\n        var _this = this;\n        var href = el.getAttribute('href');\n        var data = this.parseHref(href, os);\n        var appId = data.appId;\n        if (os && appId) {\n            el.addEventListener('click', function (e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                _this.perfromDeepLink(href, os); //, false, null, false, true /* set device switch to true so that there are no issues with popup */);\n            });\n        }\n        else if (!href || href === '#') {\n            el.style.display = 'none';\n        }\n    };\n    ;\n    return MobileRedirectService;\n}(Service_1.Service));\nexports.MobileRedirectService = MobileRedirectService;\n\n},{\"../lib/Service\":8,\"./ConsoleService\":11,\"./MobileDetectService\":17}],19:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\n//import { Promise } from 'es6-promise';\nvar Service_1 = require(\"../lib/Service\");\nvar RequestService = (function (_super) {\n    __extends(RequestService, _super);\n    function RequestService() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    RequestService.prototype.fetch = function (url, options) {\n        return new Promise(function (resolve, reject) {\n            if (!options) {\n                options = {};\n            }\n            var xhr = new XMLHttpRequest();\n            var headers = options.headers;\n            // Check if method is GET and body ias an object\n            // If it is so, parse body object an append all properties as GET parameters to the url\n            if (options.method === 'GET' && options.body) {\n                if (typeof options.body === 'object') {\n                    var separator = '';\n                    var uri = '';\n                    for (var key in options.body) {\n                        if (options.body.hasOwnProperty(key)) {\n                            var encodedKey = encodeURIComponent(key);\n                            var encodedContent = encodeURIComponent(options.body[key]);\n                            uri += \"\" + separator + encodedKey + \"=\" + encodedContent;\n                            separator = '&';\n                        }\n                    }\n                    // append the parameters to the url\n                    url = url + (url.indexOf('?') === -1 ? '?' : '&') + uri;\n                }\n                else {\n                    // Body is not an object => not allowed\n                    reject(new TypeError('Non object like body not allowed for GET requests. The body has to be an object so the properties will be appended as a GET parameter to the url.'));\n                    return;\n                }\n            }\n            else if (typeof options.body !== 'string') {\n                // if body is not a string, parse it to a json string\n                options.body = JSON.stringify(options.body);\n            }\n            // Body not allowed for HEAD requests\n            if (options.method === 'HEAD' && options.body) {\n                reject(new TypeError('Body not allowed for HEAD requests'));\n                return;\n            }\n            // Add onload event listener\n            xhr.onload = function (event) {\n                if (xhr.status >= 400 || xhr.status === 0) {\n                    reject(new Error(xhr.responseText));\n                }\n                else {\n                    resolve('response' in xhr ? xhr.response : xhr.responseText);\n                }\n            };\n            // Add onerror event listener\n            xhr.onerror = function (event) {\n                reject(event.error);\n            };\n            xhr.onabort = function (event) {\n                reject(new TypeError('Network request aborted'));\n            };\n            // Add timeout event listener\n            xhr.ontimeout = function (event) {\n                reject(new TypeError('Network request timed out'));\n            };\n            if (options.credentials && options.credentials.username) {\n                xhr.open(options.method ? options.method : 'GET', url, true, options.credentials.username, options.credentials.password);\n            }\n            else {\n                xhr.open(options.method ? options.method : 'GET', url, true);\n            }\n            if (typeof headers === 'object') {\n                for (var key in headers) {\n                    if (headers.hasOwnProperty(key)) {\n                        xhr.setRequestHeader(key, headers[key]);\n                    }\n                }\n            }\n            xhr.send(typeof options.body === 'undefined' ? null : options.body);\n        });\n    };\n    RequestService.prototype.fetchJSON = function (url, options) {\n        if (!options) {\n            options = {};\n        }\n        if (!options.headers) {\n            options.headers = {};\n        }\n        if (!options.headers['Content-Type']) {\n            options.headers['Content-Type'] = 'application/json';\n        }\n        return this.fetch(url, options).then(function (result) {\n            return JSON.parse(result);\n        });\n    };\n    return RequestService;\n}(Service_1.Service));\nexports.RequestService = RequestService;\n\n},{\"../lib/Service\":8}],20:[function(require,module,exports){\n\"use strict\";\nvar ROOMLE_TYPE;\n(function (ROOMLE_TYPE) {\n    ROOMLE_TYPE[ROOMLE_TYPE[\"ITEM\"] = 0] = \"ITEM\";\n    ROOMLE_TYPE[ROOMLE_TYPE[\"CONFIGURATION\"] = 1] = \"CONFIGURATION\";\n    ROOMLE_TYPE[ROOMLE_TYPE[\"PLAN\"] = 2] = \"PLAN\";\n    ROOMLE_TYPE[ROOMLE_TYPE[\"CONFIGURABLE_ITEM\"] = 3] = \"CONFIGURABLE_ITEM\";\n})(ROOMLE_TYPE = exports.ROOMLE_TYPE || (exports.ROOMLE_TYPE = {}));\nvar RoomleTypeService = (function () {\n    function RoomleTypeService() {\n    }\n    // TYPES ARE FROM OUTSIDE CONVERT THEM TO ENUM BECAUSE \"item\" is nicer than \"0\"\n    RoomleTypeService.convertTypeToEnum = function (type) {\n        if (type === 'item') {\n            return ROOMLE_TYPE.ITEM;\n        }\n        if (type === 'configuration') {\n            return ROOMLE_TYPE.CONFIGURATION;\n        }\n        if (type === 'plan') {\n            return ROOMLE_TYPE.PLAN;\n        }\n        if (type === 'configurable-item') {\n            return ROOMLE_TYPE.CONFIGURABLE_ITEM;\n        }\n        return null;\n    };\n    RoomleTypeService.convertRoomleType = function (type) {\n        if (type === ROOMLE_TYPE.ITEM) {\n            return 'item';\n        }\n        if (type === ROOMLE_TYPE.CONFIGURATION) {\n            return 'configuration';\n        }\n        if (type === ROOMLE_TYPE.PLAN) {\n            return 'plan';\n        }\n        if (type === ROOMLE_TYPE.CONFIGURABLE_ITEM) {\n            return 'configurable-item';\n        }\n        return null;\n    };\n    return RoomleTypeService;\n}());\nexports.RoomleTypeService = RoomleTypeService;\n\n},{}],21:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar _scriptCache = {};\nvar _idCache = {};\nfunction attachScript(url, options, resolve, reject) {\n    if (_scriptCache[url]) {\n        return resolve();\n    }\n    if (options.id && _idCache[options.id]) {\n        return reject('There is already a script with ID \"' + options.id + '\"');\n    }\n    var element = document.createElement('script');\n    element.async = true;\n    element.src = url;\n    element.id = options.id;\n    if (element.integrity !== undefined && options.integrity) {\n        element.integrity = options.integrity;\n    }\n    element.onload = function () {\n        _scriptCache[url] = true;\n        _idCache[options.id] = true;\n        resolve();\n    };\n    element.onerror = function (error) {\n        reject();\n    };\n    document.body.appendChild(element);\n}\nexports.attachScript = attachScript;\nvar ScriptLoaderService = (function (_super) {\n    __extends(ScriptLoaderService, _super);\n    function ScriptLoaderService() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    ScriptLoaderService.prototype.fetch = function (url, options) {\n        return new Promise(function (resolve, reject) {\n            attachScript(url, options, resolve, reject);\n        });\n    };\n    return ScriptLoaderService;\n}(Service_1.Service));\nexports.ScriptLoaderService = ScriptLoaderService;\n\n},{\"../lib/Service\":8}],22:[function(require,module,exports){\n\"use strict\";\nvar Environment_1 = require(\"../config/Environment\");\nvar SettingsService = (function () {\n    function SettingsService(settings) {\n        this.settings = settings;\n    }\n    SettingsService.setDefault = function (settings, key, defaultValue) {\n        var toCheck = settings;\n        var keys = key.split('.');\n        var keysLength = keys.length - 1; // LAST ONE IS SET OUTSIDE THE LOOP\n        for (var i = 0; i < keysLength; i++) {\n            if (!toCheck[keys[i]]) {\n                toCheck[keys[i]] = {};\n            }\n            toCheck = toCheck[keys[i]];\n        }\n        if (toCheck[keys[keysLength]] === undefined) {\n            toCheck[keys[keysLength]] = defaultValue;\n        }\n    };\n    SettingsService.setDeeplinkTranslation = function (settings, linkType, translation) {\n        SettingsService.setDefault(settings, 'translations.' + linkType + '.heading', translation.heading);\n        SettingsService.setDefault(settings, 'translations.' + linkType + '.hint.ios', translation.hint.ios);\n        SettingsService.setDefault(settings, 'translations.' + linkType + '.hint.android', translation.hint.android);\n        SettingsService.setDefault(settings, 'translations.' + linkType + '.hint.desktop', translation.hint.desktop);\n        SettingsService.setDefault(settings, 'tracking.enable', false);\n        SettingsService.setDefault(settings, 'tracking.tenant', 9);\n    };\n    SettingsService.init = function (settings) {\n        if (!(this._instance instanceof SettingsService)) {\n            var envSettings = Environment_1.Environment.settings();\n            var baseServer = envSettings.baseServer;\n            SettingsService.setDefault(settings, 'baseServer', baseServer);\n            SettingsService.setDefault(settings, 'web.baseUrl', baseServer + '/');\n            SettingsService.setDefault(settings, 'web.configuratorSameWindow', false);\n            SettingsService.setDefault(settings, 'viewr.baseUrl', baseServer);\n            SettingsService.setDefault(settings, 'ios.baseUrl', baseServer);\n            SettingsService.setDefault(settings, 'dataSelector.type', 'data-rml-type');\n            SettingsService.setDefault(settings, 'dataSelector.id', 'data-rml-id');\n            SettingsService.setDefault(settings, 'dataSelector.action', 'data-rml-action');\n            SettingsService.setDefault(settings, 'planId', '8a708083560ca6cf01560cd7361a014a');\n            SettingsService.setDefault(settings, 'createPopUp', true);\n            SettingsService.setDefault(settings, 'showBackButton', true);\n            SettingsService.setDefault(settings, 'html.containerClass', 'roomle-buttons');\n            SettingsService.setDefault(settings, 'html.containerType', 'div');\n            SettingsService.setDefault(settings, 'html.buttonsContainer', 'ul');\n            SettingsService.setDefault(settings, 'html.buttonElement', 'li');\n            var locale = navigator.language || navigator.userLanguage || navigator.browserLanguage;\n            SettingsService.setDefault(settings, 'locale', locale);\n            SettingsService.setDefault(settings, 'css.buttons.position', 'absolute');\n            SettingsService.setDefault(settings, 'css.buttons.top', '0');\n            SettingsService.setDefault(settings, 'css.buttons.right', '0');\n            SettingsService.setDefault(settings, 'css.buttons.line-height', 'normal');\n            SettingsService.setDefault(settings, 'css.item.position', 'relative');\n            SettingsService.setDefault(settings, 'deepLinkInterstitialUrl', baseServer + 'deeplink');\n            SettingsService.setDefault(settings, 'callback', {});\n            SettingsService.setDefault(settings, 'callback.button', {});\n            SettingsService.setDefault(settings, 'popUpSelector', 'data-rml-deeplink-popup-container');\n            SettingsService.setDefault(settings, 'callback.booted', function () {\n            });\n            SettingsService.setDefault(settings, 'translations.errors.deeplinkcreate', 'Error creating deeplink');\n            var hint = ''; //'This feature is not available on your platform. ';\n            var androidHint = hint + 'Enter the following link into the browser of your desktop device';\n            var iosHint = hint + 'Enter the following link into the browser of your iOS device';\n            this.setDeeplinkTranslation(settings, 'ar', {\n                heading: 'Visualize in AR',\n                hint: { ios: iosHint, android: null, desktop: null }\n            });\n            this.setDeeplinkTranslation(settings, 'add', {\n                heading: 'Add to plan',\n                hint: { ios: null, android: null, desktop: androidHint }\n            });\n            this.setDeeplinkTranslation(settings, 'configure', {\n                heading: 'Customize',\n                hint: { ios: null, android: null, desktop: androidHint }\n            });\n            this.setDeeplinkTranslation(settings, 'mark', {\n                heading: 'Favourite',\n                hint: { ios: null, android: null, desktop: null }\n            });\n            this.setDeeplinkTranslation(settings, 'trigger', {\n                heading: 'Trigger',\n                hint: { ios: null, android: null, desktop: null }\n            });\n            this.setDeeplinkTranslation(settings, 'visualize', {\n                heading: 'Visualize',\n                hint: { ios: null, android: androidHint, desktop: null }\n            });\n            this.setDeeplinkTranslation(settings, 'vr', {\n                heading: 'View in VR',\n                hint: { ios: iosHint, android: '', desktop: '' }\n            });\n            this.setDeeplinkTranslation(settings, 'start_now', {\n                heading: 'Start planning now',\n                hint: { ios: iosHint, android: '', desktop: '' }\n            });\n            this._instance = new this(settings);\n        }\n        return this._instance;\n    };\n    SettingsService.getInstance = function () {\n        return this._instance;\n    };\n    Object.defineProperty(SettingsService, \"settings\", {\n        get: function () {\n            return SettingsService.getInstance().settings;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    return SettingsService;\n}());\nexports.SettingsService = SettingsService;\n\n},{\"../config/Environment\":2}],23:[function(require,module,exports){\n\"use strict\";\nvar __extends = (this && this.__extends) || function (d, b) {\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    function __() { this.constructor = d; }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n};\nvar Service_1 = require(\"../lib/Service\");\nvar SettingsService_1 = require(\"./SettingsService\");\nvar Environment_1 = require(\"../config/Environment\");\nvar ConsoleService_1 = require(\"./ConsoleService\");\nvar ID = 'rml-tracking-iframe';\nvar TrackingService = (function (_super) {\n    __extends(TrackingService, _super);\n    function TrackingService() {\n        var _this = _super.call(this) || this;\n        _this.isGAInitialized = false;\n        _this.gaProvider = null;\n        if (SettingsService_1.SettingsService.settings.tracking.enable && !SettingsService_1.SettingsService.settings.tracking.gaProvider) {\n            var iframe = document.createElement('iframe');\n            iframe.setAttribute('src', Environment_1.Environment.settings().gaUrl);\n            iframe.setAttribute('id', ID);\n            iframe.setAttribute('style', 'visibility:hidden!important;display:none;width:0;height:0;');\n            iframe.height = '0';\n            iframe.width = '0';\n            document.body.appendChild(iframe);\n        }\n        return _this;\n    }\n    TrackingService.toLabel = function (id, action, interactionType) {\n        if (action === void 0) { action = null; }\n        if (interactionType === void 0) { interactionType = null; }\n        return id + ((action) ? '#' + action : '') + ((interactionType) ? '#' + interactionType : '');\n    };\n    TrackingService.prototype.getUid = function () {\n        if (window.location.href.indexOf('roomle.com') === -1) {\n            return null;\n        }\n        if (!window.localStorage) {\n            return null;\n        }\n        var session = window.localStorage.getItem('ember_simple_auth:session');\n        try {\n            if (session) {\n                var parsedSession = JSON.parse(session);\n                if (parsedSession.authenticated && parsedSession.authenticated.auth) {\n                    return parsedSession.authenticated.auth.userId;\n                }\n            }\n            return null;\n        }\n        catch (e) {\n            ConsoleService_1.ConsoleService.error('can not parse ember_simple_auth:session\"' + e + '\"');\n            return null;\n        }\n    };\n    TrackingService.prototype.getGAProvider = function () {\n        var _this = this;\n        if (this.gaProvider) {\n            return this.gaProvider;\n        }\n        var gaProvider = null;\n        if (SettingsService_1.SettingsService.settings.tracking.gaProvider) {\n            gaProvider = {\n                ga: SettingsService_1.SettingsService.settings.tracking.gaProvider,\n                gaSetUid: function () {\n                    var uid = _this.getUid();\n                    if (!uid) {\n                        return;\n                    }\n                    SettingsService_1.SettingsService.settings.tracking.gaProvider('set', '&uid', uid);\n                },\n                gaSetTenant: function (tenant) {\n                    SettingsService_1.SettingsService.settings.tracking.gaProvider('set', 'dimension1', tenant);\n                }\n            };\n        }\n        else {\n            var iframe = document.getElementById(ID);\n            if (!iframe) {\n                return null;\n            }\n            var contentWindow = iframe.contentWindow;\n            if (!contentWindow) {\n                return null;\n            }\n            var _sendToRoomle = function (command) {\n                var args = [];\n                for (var _i = 1; _i < arguments.length; _i++) {\n                    args[_i - 1] = arguments[_i];\n                }\n                var commands = ['MessageFromRoomle.' + command];\n                commands.push.apply(commands, args);\n                // DONT USE CONTENTWINDOW VARIABLE HERE, OTHERWISE IE11 BREAKS!!!\n                document.getElementById(ID).contentWindow.postMessage(JSON.stringify(commands), '*');\n            };\n            gaProvider = {\n                ga: function () {\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    _sendToRoomle.apply(void 0, ['ga'].concat(args));\n                },\n                gaSetUid: function () {\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    _sendToRoomle.apply(void 0, ['gaSetUid'].concat(args));\n                },\n                gaSetTenant: function () {\n                    var args = [];\n                    for (var _i = 0; _i < arguments.length; _i++) {\n                        args[_i] = arguments[_i];\n                    }\n                    _sendToRoomle.apply(void 0, ['gaSetTenant'].concat(args));\n                }\n            };\n        }\n        this.gaProvider = gaProvider;\n        return gaProvider;\n    };\n    TrackingService.prototype.initGA = function (gaProvider) {\n        this.isGAInitialized = true;\n        gaProvider.gaSetUid();\n        gaProvider.gaSetTenant(SettingsService_1.SettingsService.settings.tracking.tenant);\n    };\n    TrackingService.prototype.trackGA = function (action, label, value) {\n        var category = TrackingService.GA_CATEGROY;\n        var enabled = SettingsService_1.SettingsService.settings.tracking.enable;\n        var provider = this.getGAProvider();\n        if (!enabled || !provider) {\n            return;\n        }\n        var data = {};\n        if (category) {\n            data.eventCategory = category;\n        }\n        if (action) {\n            data.eventAction = action;\n        }\n        if (label) {\n            data.eventLabel = label;\n        }\n        if (typeof value === 'number') {\n            data.eventValue = value;\n        }\n        data.hitType = 'event';\n        if (!this.isGAInitialized) {\n            this.initGA(provider);\n        }\n        return provider.ga('send', data);\n    };\n    TrackingService.prototype.trackGAInteraction = function (label, id, action, value) {\n        if (label.substr(-1) === ':') {\n            this.trackGA(label, TrackingService.toLabel(id, action), value || 1);\n            this.trackGA('Interaction:', TrackingService.toLabel(id, action, label.slice(0, -1)), value || 1);\n        }\n        else {\n            this.trackGA(label, action, value);\n        }\n    };\n    return TrackingService;\n}(Service_1.Service));\nTrackingService.GA_CATEGROY = 'RoomleButton';\nexports.TrackingService = TrackingService;\n\n},{\"../config/Environment\":2,\"../lib/Service\":8,\"./ConsoleService\":11,\"./SettingsService\":22}],24:[function(require,module,exports){\n\"use strict\";\nvar EnumEx = (function () {\n    function EnumEx() {\n    }\n    EnumEx.getNamesAndValues = function (e) {\n        return this.getNames(e).map(function (n) { return { name: n, value: e[n] }; });\n    };\n    EnumEx.getNames = function (e) {\n        return this.getObjValues(e).filter(function (v) { return typeof v === 'string'; });\n    };\n    EnumEx.getValues = function (e) {\n        return this.getObjValues(e).filter(function (v) { return typeof v === 'number'; });\n    };\n    EnumEx.getObjValues = function (e) {\n        return Object.keys(e).map(function (k) { return e[k]; });\n    };\n    return EnumEx;\n}());\nexports.EnumEx = EnumEx;\n\n},{}]},{},[9]);\n"]}