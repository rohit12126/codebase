THREE.DepthShadowGenerator={clamp01:function(e){return e<=0?0:e>=1?1:e},idealPowerOfTwoSize:function(e){return e>800?1024:e>400?512:e>200?256:e>100?128:e>50?64:e>25?32:16},blurTexture:function(e,a,r,t){var n=a===THREE.RGBFormat?3:4,i=t.clone().multiplyScalar(2).addScalar(1).multiply(r).multiply(t).multiplyScalar(2);i.x=this.idealPowerOfTwoSize(i.x),i.y=this.idealPowerOfTwoSize(i.y);for(var l=i.x*i.y,o=new Uint8Array(l),E=0;E<i.x;E++)for(var T=(E/(i.x-1)-.5)*(1+2*t.x)+.5,y=Math.round((T-t.x)*r.x),x=Math.round((T+t.x)*r.x),p=0;p<i.y;p++){var d=p*i.x,R=(p/(i.y-1)-.5)*(1+2*t.y)+.5,w=Math.round((R-t.y)*r.y),h=Math.round((R+t.y)*r.y),u=0,m=0,H=(x-y)/2;0==H&&(H=1);var s=(x+y)/2,M=(h-w)/2;0==M&&(M=1);for(var c=(h+w)/2,v=y;v<=x;v++)for(var f=Math.abs(v-s)/H,g=w;g<=h;g++){var S=Math.abs(g-c)/M,P=1-Math.sqrt(f*f+S*S);P<.01||(u+=1-(1-(v<0||v>=r.x||g<0||g>=r.y?1:e[(v+g*r.x)*n]/255))*P,m++)}u/=m,u=Math.pow(u,.5),u*=255,o[d+E]=u}return rampTex=new THREE.DataTexture(o,i.x,i.y,THREE.LuminanceFormat,THREE.UnsignedByteType,THREE.UVMapping,THREE.ClampToEdgeWrapping,THREE.ClampToEdgeWrapping,THREE.LinearFilter,THREE.LinearMipMapLinearFilter),rampTex},createShadowPlane:function(e,a,r,t){var n=new THREE.Vector2(r.x,r.z),i=n.clone().multiplyScalar(200);i.x=this.idealPowerOfTwoSize(i.x),i.y=this.idealPowerOfTwoSize(i.y);var l=THREE.RGBAFormat,o=new THREE.WebGLRenderTarget(i.x,i.y,{format:l,minFilter:THREE.LinearFilter,magFilter:THREE.NearestFilter}),E=new THREE.MeshDepthMaterial,T=new THREE.OrthographicCamera(n.x/-2,n.x/2,n.y/-2,n.y/2,.01,1);T.layers.set(t),T.position.y=-.011,T.rotation.x=Math.PI/2;var y=new THREE.MeshBasicMaterial({map:o,transparent:!0,blending:THREE.MultiplyBlending}),x=n.clone().addScalar(.2),p=new THREE.PlaneGeometry(x.x,x.y,1),d=new THREE.Mesh(p,y);d.rotation.x=-Math.PI/2,d.name="ShadowPlane",e.setClearColor(new THREE.Color(1,1,1),1),a.overrideMaterial=E,e.clearTarget(o,!0,!0,!0),e.render(a,T,o);var R=i.x*i.y,w=l===THREE.RGBFormat?3:4,h=new Uint8Array(R*w);e.readRenderTargetPixels(o,0,0,i.x,i.y,h);var u=new THREE.Vector2(.1/n.x,.1/n.y),m=this.blurTexture(h,l,i,u);return m.generateMipmaps=!0,m.needsUpdate=!0,y.map=m,a.overrideMaterial=null,d}};